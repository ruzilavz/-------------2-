<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>AVZALØV (Рузиль Авзалов) — Официальный сайт</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Официальный сайт артиста AVZALØV (Рузиль Авзалов). Музыка, релизы, новости и контакты." />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* убирает нативный стиль у элементов формы */
    button,
    input,
    select {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }

    :root {
      --bg: #05060a;
      --accent: #2f6bff;
      --accent-soft: rgba(47, 107, 255, 0.2);
      --text: #f5f5f5;
      --muted: #9a9fb4;
      --card: #101320;
      --border: #1c2133;
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.65);
      --shadow-sm: 0 8px 20px rgba(0, 0, 0, 0.5);
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      --transition: 200ms ease-out;
      --active-cover: none;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-main);
      background: radial-gradient(circle at top, #151a33 0, var(--bg) 55%);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: var(--active-cover);
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0;
      transition: opacity var(--transition);
      pointer-events: none;
      filter: blur(5px);
      transform: scale(1.1);
      z-index: -1;
    }

    body.has-active-cover::before {
      opacity: 0.6;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    img {
      max-width: 100%;
      display: block;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px 16px 60px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 32px;
      position: relative;
      z-index: 10;
    }

    .logo-group {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-mark {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 600;
      color: var(--accent);
      box-shadow: 0 0 12px rgba(47, 107, 255, 0.3);
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .logo-text-main {
      font-weight: 700;
      letter-spacing: 0.22em;
      font-size: 13px;
      text-transform: uppercase;
    }

    .logo-text-sub {
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.18em;
    }

    nav {
      display: flex;
      gap: 18px;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted);
    }

    nav a {
      position: relative;
      padding-bottom: 4px;
    }

    nav a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      width: 0;
      height: 2px;
      background: var(--accent);
      border-radius: 999px;
      transition: width var(--transition);
    }

    nav a:hover::after {
      width: 100%;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .header-action-group {
      position: relative;
      display: flex;
      align-items: center;
    }

    .ruzcoin-chip {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(47, 107, 255, 0.38);
      background: rgba(14, 16, 28, 0.95);
      box-shadow: 0 10px 24px rgba(18, 20, 36, 0.5);
      cursor: pointer;
      color: inherit;
      transition: transform var(--transition), border-color var(--transition), box-shadow var(--transition);
    }

    .ruzcoin-chip:hover,
    .ruzcoin-chip:focus-visible {
      transform: translateY(-2px);
      border-color: rgba(47, 107, 255, 0.65);
      box-shadow: 0 14px 32px rgba(38, 54, 120, 0.55);
      outline: none;
    }

    .ruzcoin-info {
      display: flex;
      flex-direction: column;
      line-height: 1.1;
    }

    .ruzcoin-label {
      font-size: 10px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, 0.55);
    }

    .ruzcoin-value {
      font-size: 15px;
      font-weight: 700;
    }

    .ruzcoin-icon {
      width: 28px;
      height: 28px;
      border-radius: 12px;
      background: linear-gradient(130deg, #ffe066, #ffb347);
      color: #0c0f1c;
      font-weight: 700;
      font-size: 11px;
      letter-spacing: 0.08em;
      display: flex;
      align-items: center;
      justify-content: center;
      text-transform: uppercase;
      box-shadow: 0 6px 18px rgba(255, 179, 71, 0.4);
    }

    .ruzcoin-icon.is-inline {
      width: 22px;
      height: 22px;
      font-size: 10px;
      margin-right: 6px;
      box-shadow: none;
    }

    .header-profile-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: rgba(9, 12, 24, 0.9);
      color: var(--text);
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      cursor: pointer;
      transition: background var(--transition), border-color var(--transition), transform var(--transition);
    }

    .header-profile-btn:hover,
    .header-profile-btn:focus-visible {
      background: rgba(26, 36, 74, 0.95);
      border-color: rgba(47, 107, 255, 0.7);
      transform: translateY(-2px);
      outline: none;
    }

    .header-profile-btn i {
      font-size: 14px;
    }

    .header-popover {
      position: absolute;
      top: calc(100% + 14px);
      right: 0;
      width: min(320px, 80vw);
      padding: 16px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(47, 107, 255, 0.28);
      background: rgba(10, 12, 24, 0.98);
      box-shadow: var(--shadow-soft);
      display: none;
      flex-direction: column;
      gap: 14px;
      z-index: 30;
    }

    .header-popover::before {
      content: "";
      position: absolute;
      top: -8px;
      right: 18px;
      width: 16px;
      height: 16px;
      transform: rotate(45deg);
      background: inherit;
      border-left: 1px solid rgba(47, 107, 255, 0.28);
      border-top: 1px solid rgba(47, 107, 255, 0.28);
      pointer-events: none;
      z-index: -1;
    }

    .header-popover[data-open="true"] {
      display: flex;
      animation: popoverFade var(--transition) ease;
    }

    @keyframes popoverFade {
      from {
        opacity: 0;
        transform: translateY(-6px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .popover-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .popover-title {
      font-size: 13px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
    }

    .popover-sub {
      font-size: 11px;
      color: var(--muted);
      letter-spacing: 0.06em;
    }

    .popover-text,
    .popover-footnote {
      font-size: 12px;
      color: rgba(240, 243, 255, 0.78);
      line-height: 1.45;
    }

    .popover-footnote {
      border-top: 1px solid rgba(47, 107, 255, 0.12);
      padding-top: 10px;
      margin-top: 6px;
      font-size: 11px;
      color: var(--muted);
    }

    .popover-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .popover-actions .btn {
      flex: 1 1 auto;
      min-width: 120px;
      justify-content: center;
    }

    .popover-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 8px;
    }

    .popover-form input {
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(47, 107, 255, 0.3);
      background: rgba(7, 9, 18, 0.9);
      color: var(--text);
      font-size: 13px;
    }

    .popover-form input:focus-visible {
      outline: 2px solid rgba(47, 107, 255, 0.6);
      outline-offset: 1px;
    }

    .admin-login {
      border-radius: 12px;
      border: 1px solid rgba(47, 107, 255, 0.24);
      padding: 10px 12px;
      background: rgba(8, 10, 22, 0.92);
    }

    .admin-login summary {
      cursor: pointer;
      font-size: 12px;
      color: rgba(195, 204, 255, 0.86);
      letter-spacing: 0.06em;
    }

    .admin-login[open] summary {
      margin-bottom: 8px;
      color: #f0f3ff;
    }

    .profile-popover-section {
      display: none;
      flex-direction: column;
      gap: 12px;
    }

    .profile-popover-section.is-visible {
      display: flex;
    }

    .popover-balance {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(47, 107, 255, 0.18);
      background: rgba(15, 18, 32, 0.9);
    }

    .popover-meta {
      font-size: 11px;
      color: var(--muted);
      letter-spacing: 0.04em;
    }

    .popover-balance-value {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.08em;
    }

    .profile-empty {
      border-radius: var(--radius-lg);
      border: 1px dashed rgba(47, 107, 255, 0.4);
      background: rgba(10, 13, 26, 0.8);
      padding: 24px;
      color: rgba(220, 225, 255, 0.8);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .profile-empty h3 {
      font-size: 16px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #dce2ff;
    }

    .profile-empty p {
      font-size: 13px;
      line-height: 1.6;
    }

    .profile-role {
      font-size: 12px;
      color: var(--muted);
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .chip-soon {
      font-size: 9px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(255, 205, 150, 0.4);
      background: rgba(255, 195, 120, 0.15);
      color: #ffd08a;
    }

    .nav-toggle {
      display: none;
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(7, 8, 15, 0.9);
      color: var(--muted);
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .hero {
      display: flex;
      gap: 26px;
      margin-bottom: 40px;
      align-items: center;
      flex-wrap: wrap;
    }

    .hero-left {
      display: flex;
      align-items: center;
      gap: 18px;
      flex: 1 1 260px;
      min-width: 0;
    }

    .hero-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background-image: url("img/avzalov.jpg");
      background-size: cover;
      background-position: center 40%;
      position: relative;
      overflow: hidden;
      filter: blur(0.6px) contrast(1.05) saturate(1.02);
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.07), 0 14px 30px rgba(0, 0, 0, 0.7);
      flex-shrink: 0;
    }

    .hero-avatar::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 30% 0, rgba(255, 255, 255, 0.24), transparent 55%);
      mix-blend-mode: screen;
      opacity: 0.8;
    }

    .hero-avatar-label {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      letter-spacing: 0.26em;
      text-transform: uppercase;
      color: #f5f6ff;
      text-align: center;
      padding: 0 14px;
      background: radial-gradient(circle at 50% 120%, rgba(0, 0, 0, 0.55), transparent 55%);
    }

    .hero-main {
      flex: 2 1 320px;
      min-width: 0;
    }

    .hero-title {
      font-size: clamp(26px, 4.6vw, 38px);
      font-weight: 800;
      letter-spacing: 0.07em;
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    .hero-subtitle {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .hero-subtitle span {
      color: #d9defb;
      font-weight: 600;
    }

    .hero-text {
      font-size: 15px;
      color: var(--muted);
      max-width: 520px;
      margin-bottom: 22px;
    }

    .hero-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    .tag {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid rgba(89, 109, 184, 0.45);
      background: radial-gradient(circle at top, rgba(92, 134, 255, 0.09), rgba(10, 12, 24, 0.9));
      color: var(--muted);
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .btn {
      border-radius: 999px;
      padding: 11px 20px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform var(--transition), box-shadow var(--transition), background var(--transition), color var(--transition);
    }

    .btn-primary {
      background: linear-gradient(135deg, #2f6bff, #6d9dff);
      color: #fff;
      box-shadow: 0 16px 40px rgba(47, 107, 255, 0.45);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 22px 50px rgba(47, 107, 255, 0.55);
    }

    .btn-ghost {
      background: rgba(7, 9, 18, 0.9);
      border: 1px solid var(--border);
      color: var(--muted);
    }

    .btn-ghost:hover {
      background: rgba(18, 22, 34, 0.96);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .btn-sm {
      padding: 8px 16px;
      font-size: 12px;
    }

    .btn-xs {
      padding: 6px 12px;
      font-size: 11px;
    }

    section {
      margin-bottom: 40px;
    }

    .section-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
    }

    .section-title {
      font-size: 18px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
    }

    .section-sub {
      font-size: 12px;
      color: var(--muted);
    }

    /* Профиль / личный кабинет */
    .profile-wrapper {
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      background: radial-gradient(circle at top, rgba(47, 107, 255, 0.16), rgba(5, 6, 12, 0.98));
      padding: 18px 18px 20px;
      box-shadow: var(--shadow-soft);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      align-items: start;
    }

    .profile-panel {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .profile-main {
      display: flex;
      gap: 14px;
      align-items: center;
    }

    .profile-avatar {
      width: 70px;
      height: 70px;
      border-radius: 24px;
      background-image: url("img/avzalov.jpg");
      background-size: cover;
      background-position: center 40%;
      box-shadow: 0 14px 32px rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .profile-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .profile-name {
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    .profile-id {
      font-size: 11px;
      color: var(--muted);
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .profile-coins {
      font-size: 13px;
      margin-top: 2px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .coins-amount {
      font-weight: 700;
      color: #ffd56a;
    }

    .profile-actions-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }

    .profile-achievements h4 {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      margin-bottom: 8px;
      color: #d4ddff;
    }

    .achievements-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
    }

    .achievement-card {
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(5, 7, 15, 0.96);
      padding: 8px 9px;
      font-size: 11px;
      color: #c4c8e4;
      position: relative;
      overflow: hidden;
    }

    .achievement-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(87, 133, 255, 0.32), transparent 65%);
      opacity: 0;
      transition: opacity 160ms ease;
    }

    .achievement-card.unlocked::before {
      opacity: 1;
    }

    .achievement-title {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .achievement-desc {
      font-size: 10px;
      color: rgba(189, 195, 232, 0.85);
    }

    .achievement-badge {
      position: absolute;
      top: 6px;
      right: 7px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #3ce39a;
    }

    .tracks-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 24px;
    }

    .track-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .tracks-carousel-shell {
      position: relative;
      display: flex;
      align-items: stretch;
      gap: 10px;
      padding: 0 32px;
    }

    .tracks-carousel-shell::before,
    .tracks-carousel-shell::after {
      content: "";
      position: absolute;
      top: 0;
      bottom: 0;
      width: 42px;
      pointer-events: none;
      z-index: 1;
    }

    .tracks-carousel-shell::before {
      left: 32px;
      background: linear-gradient(90deg, rgba(5, 6, 10, 0.85), transparent);
    }

    .tracks-carousel-shell::after {
      right: 32px;
      background: linear-gradient(270deg, rgba(5, 6, 10, 0.85), transparent);
    }

    .tracks-carousel {
      display: flex;
      gap: 20px;
      overflow-x: auto;
      padding: 12px 4px 24px;
      scroll-snap-type: x mandatory;
      scroll-behavior: smooth;
      scrollbar-width: none;
      -webkit-overflow-scrolling: touch;
    }

    .tracks-carousel::-webkit-scrollbar {
      display: none;
    }

    /* Мини-галерея треков */
    .tracks-mini-gallery {
      margin: 0 0 32px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .mini-gallery-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .mini-gallery-title {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .mini-gallery-filters {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .mini-gallery-filter {
      border: 1px solid var(--border);
      background: rgba(12, 14, 24, 0.7);
      color: var(--muted);
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 12px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all var(--transition);
    }

    .mini-gallery-filter:hover,
    .mini-gallery-filter:focus-visible {
      color: #fff;
      border-color: rgba(255, 255, 255, 0.18);
      outline: none;
    }

    .mini-gallery-filter.is-active {
      background: var(--accent);
      color: #fff;
      border-color: rgba(255, 255, 255, 0.12);
      box-shadow: 0 10px 24px rgba(47, 107, 255, 0.35);
    }

    .tracks-gallery-scroller {
      display: grid;
      grid-auto-flow: column;
      grid-template-rows: repeat(2, minmax(0, 1fr));
      grid-auto-columns: minmax(220px, 1fr);
      gap: 14px;
      overflow-x: auto;
      padding: 4px 2px 10px;
      scroll-snap-type: x proximity;
      scrollbar-width: thin;
    }

    .tracks-gallery-scroller::-webkit-scrollbar {
      height: 6px;
    }

    .tracks-gallery-scroller::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.18);
      border-radius: 999px;
    }

    .mini-gallery-card {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: space-between;
      gap: 12px;
      padding: 12px;
      border-radius: var(--radius-md);
      background: rgba(12, 14, 24, 0.85);
      border: 1px solid rgba(255, 255, 255, 0.06);
      color: var(--text);
      text-align: left;
      cursor: pointer;
      transition: border-color var(--transition), transform var(--transition), background var(--transition);
      scroll-snap-align: start;
      min-height: 200px;
    }

    .mini-gallery-card:hover,
    .mini-gallery-card:focus-visible {
      border-color: var(--accent);
      background: rgba(19, 24, 42, 0.95);
      transform: translateY(-2px);
      outline: none;
    }

    .mini-gallery-cover {
      width: 100%;
      padding-top: 100%;
      border-radius: 16px;
      background-size: cover;
      background-position: center;
      background-image: linear-gradient(140deg, rgba(38, 52, 110, 0.85), rgba(12, 16, 32, 0.9));
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.55);
      flex-shrink: 0;
    }

    .mini-gallery-body {
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-width: 0;
    }

    .mini-gallery-name {
      font-size: 14px;
      font-weight: 600;
      line-height: 1.3;
      word-break: break-word;
    }

    .mini-gallery-meta {
      font-size: 12px;
      color: var(--muted);
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }

    .mini-gallery-badge {
      align-self: flex-start;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.08);
      color: var(--muted);
    }

    .mini-gallery-badge.public {
      background: rgba(65, 193, 120, 0.18);
      color: #b6f7d5;
    }

    .mini-gallery-badge.early-access {
      background: rgba(47, 107, 255, 0.16);
      color: #adc3ff;
    }

    .mini-gallery-badge.upcoming {
      background: rgba(255, 166, 0, 0.18);
      color: #ffe0a3;
    }

    .mini-gallery-empty {
      padding: 12px 16px;
      color: var(--muted);
      font-size: 13px;
    }

    .mini-gallery-meta .dot {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: currentColor;
      opacity: 0.6;
    }

    @media (max-width: 640px) {
      .mini-gallery-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .mini-gallery-filters {
        justify-content: flex-start;
      }

      .mini-gallery-card {
        flex: 0 0 180px;
      }
    }

    .carousel-arrow {
      width: 46px;
      height: 100%;
      border-radius: 16px;
      border: 1px solid rgba(85, 108, 203, 0.45);
      background: rgba(18, 24, 46, 0.8);
      color: #f9f9ff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background var(--transition), transform 200ms ease;
      z-index: 2;
    }

    .carousel-arrow i {
      font-size: 18px;
    }

    .carousel-arrow:hover {
      background: rgba(53, 72, 141, 0.95);
      transform: translateY(-2px);
    }

    .tracks-carousel .track-card {
      flex: 0 0 calc(82vw - 48px);
      max-width: 360px;
      min-width: 260px;
      scroll-snap-align: start;
    }

    @media (min-width: 600px) {
      .tracks-carousel .track-card {
        flex: 0 0 calc(50vw - 60px);
      }
    }

    @media (min-width: 960px) {
      .tracks-carousel .track-card {
        flex: 0 0 320px;
      }
    }

    @media (min-width: 1280px) {
      .tracks-carousel .track-card {
        flex: 0 0 340px;
      }
    }

    .track-card {
      --lift: 0px;
      --tilt-x: 0deg;
      --tilt-y: 0deg;
      --glow-x: 50%;
      --glow-y: 50%;
      position: relative;
      background: linear-gradient(140deg, rgba(30, 39, 84, 0.8), rgba(12, 15, 30, 0.95));
      border-radius: 20px;
      border: 1px solid rgba(68, 95, 189, 0.25);
      padding: 18px 18px 20px;
      display: flex;
      gap: 18px;
      align-items: center;
      box-shadow: 0 18px 40px rgba(5, 8, 20, 0.55);
      transition: transform 160ms ease, box-shadow 220ms ease, border-color 220ms ease, filter 200ms ease;
      overflow: hidden;
      transform-style: preserve-3d;
      transform: perspective(1200px) rotateX(var(--tilt-x)) rotateY(var(--tilt-y)) translate3d(0, var(--lift), 0);
      will-change: transform;
    }

    .track-card::before {
      content: "";
      position: absolute;
      inset: 1px;
      border-radius: 18px;
      background: radial-gradient(circle at top left, rgba(86, 131, 255, 0.28), transparent 60%);
      opacity: 0;
      transition: opacity 220ms ease;
      pointer-events: none;
    }

    .track-card::after {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(
        circle at var(--glow-x) var(--glow-y),
        rgba(47, 107, 255, 0.28),
        transparent 65%
      );
      opacity: 0;
      transition: opacity 220ms ease;
      pointer-events: none;
    }

    .track-card:hover {
      --lift: -12px;
      box-shadow: 0 26px 50px rgba(8, 12, 32, 0.6);
      border-color: rgba(86, 131, 255, 0.45);
    }

    .track-card.is-highlighted {
      border-color: rgba(86, 131, 255, 0.85);
      box-shadow: 0 28px 56px rgba(47, 107, 255, 0.35);
    }

    .track-card:hover::before,
    .track-card.playing::before,
    .track-card.playing::after {
      opacity: 1;
    }

    .track-card.playing {
      --lift: -16px;
      border-color: rgba(61, 208, 156, 0.7);
      box-shadow: 0 28px 60px rgba(30, 215, 160, 0.3);
    }

    .track-card[data-status="ep"] {
      border-color: rgba(118, 146, 238, 0.45);
      box-shadow: 0 22px 48px rgba(32, 42, 92, 0.65);
    }

    .track-card[data-status="soon"] {
      border-color: rgba(255, 189, 97, 0.45);
      box-shadow: 0 22px 46px rgba(255, 168, 72, 0.2);
    }

    .track-card[data-status="soon"] .track-meta span:last-child {
      color: rgba(255, 208, 138, 0.9);
    }

    .track-card[data-has-audio="false"] .track-cover,
    .track-card[data-has-audio="false"] .track-play-toggle {
      cursor: default;
    }

    .track-card[data-has-audio="false"] .play-overlay {
      display: none;
    }

    .track-card[data-has-audio="false"] .track-play-toggle:hover,
    .track-card[data-has-audio="false"] .track-play-toggle:active {
      transform: none;
      box-shadow: none;
    }

    .track-card[data-has-audio="false"] .track-play-toggle {
      background: linear-gradient(140deg, rgba(90, 96, 140, 0.55), rgba(64, 69, 104, 0.8));
      box-shadow: none;
    }

    .track-card[data-has-audio="false"] .time-display {
      font-size: 11px;
      color: rgba(200, 205, 235, 0.65);
    }

    .player-controls.is-disabled {
      opacity: 0.75;
      filter: saturate(0.75);
    }

    .player-controls.is-disabled .track-play-toggle,
    .player-controls.is-disabled .progress-bar {
      cursor: not-allowed;
    }

    .track-card.track-locked {
      border-color: rgba(255, 189, 97, 0.45);
      box-shadow: 0 22px 46px rgba(255, 168, 72, 0.2);
      filter: saturate(0.85);
    }

    .track-card.track-locked .track-cover::after {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(7, 10, 20, 0.58);
      backdrop-filter: blur(2px);
    }

    .track-card.track-locked .play-overlay {
      opacity: 1;
    }

    .track-card.track-locked .player-controls {
      opacity: 0.55;
      pointer-events: none;
    }

    .track-card.track-locked .track-locked-note {
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(255, 207, 143, 0.85);
      margin-bottom: 10px;
    }

    .track-locked-note.is-hidden {
      display: none;
    }

    .track-card.track-locked .unlock-btn {
      border-color: rgba(255, 196, 120, 0.75);
      background: rgba(40, 24, 5, 0.7);
      color: #ffd68a;
      box-shadow: 0 8px 22px rgba(255, 176, 80, 0.25);
    }

    .track-card.track-locked .unlock-btn:hover {
      background: linear-gradient(130deg, rgba(255, 203, 122, 0.2), rgba(255, 176, 80, 0.35));
      border-color: rgba(255, 213, 150, 0.85);
    }

    .track-cover {
      position: relative;
      width: 96px;
      height: 96px;
      border-radius: 16px;
      background-size: cover;
      background-position: center;
      background-color: #1b2031;
      flex-shrink: 0;
      overflow: hidden;
      cursor: pointer;
    }

    .track-cover::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(160deg, rgba(255, 255, 255, 0.18), transparent 55%);
      mix-blend-mode: screen;
    }

    .track-cover .play-overlay {
      position: absolute;
      inset: 0;
      background: rgba(6, 9, 20, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      color: #eef2ff;
      opacity: 0;
      transition: opacity var(--transition);
      backdrop-filter: blur(4px);
    }

    .track-card:hover .track-cover .play-overlay,
    .track-card.playing .track-cover .play-overlay {
      opacity: 1;
    }

    .track-info {
      flex: 1;
      min-width: 0;
      position: relative;
      z-index: 1;
    }

    .track-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 6px;
    }

    .track-title {
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 0.02em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .track-stats {
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 12px;
    }
    .track-like-btn, .track-plays {
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .track-like-btn {
        background: none;
        border: none;
        color: inherit;
        cursor: pointer;
        padding: 0;
    }
    .track-like-btn.is-liked {
        color: #ff6b81;
    }
    .track-price {
        font-size: 12px;
        color: #ffd56a;
        margin-bottom: 12px;
    }
    .track-price .ruzcoin-icon {
        width: 16px;
        height: 16px;
        font-size: 8px;
        margin-right: 4px;
        vertical-align: middle;
    }
    .track-copyright {
        font-size: 10px;
        color: var(--muted);
        opacity: 0.7;
        margin-top: 12px;
        border-top: 1px solid var(--border);
        padding-top: 8px;
    }

    .track-card.playing .track-title {
      color: #effffc;
    }

    .track-badge {
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.07);
      color: var(--muted);
      white-space: nowrap;
      flex-shrink: 0;
    }

    .track-badge.public {
      background: rgba(65, 193, 120, 0.18);
      color: #b6f7d5;
    }

    .track-badge.early-access {
      background: rgba(47, 107, 255, 0.18);
      color: #adc3ff;
    }

    .track-badge.upcoming {
      background: rgba(255, 166, 0, 0.2);
      color: #ffe0a3;
    }

    .track-meta {
      font-size: 12px;
      color: rgba(206, 212, 242, 0.8);
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .track-card.upcoming .track-meta {
      margin-bottom: 8px;
      opacity: 0.85;
    }

    .dot {
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: rgba(206, 212, 242, 0.4);
    }

    .track-divider {
      padding: 6px 4px 0;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      font-size: 12px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(166, 173, 215, 0.78);
    }

    .track-divider-meta {
      font-size: 12px;
      color: var(--muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }


    .track-divider .track-divider-meta {
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: none;
      color: rgba(199, 204, 236, 0.7);
    }

    .player-controls {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 14px;
    }

    .track-play-toggle {
      width: 46px;
      height: 46px;
      border-radius: 14px;
      border: none;
      background: linear-gradient(140deg, #2f6bff, #8aa2ff);
      box-shadow: 0 18px 30px rgba(47, 107, 255, 0.45);
      color: #f8f9ff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      transition: transform 180ms ease, box-shadow 180ms ease;
    }

    .track-play-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 22px 40px rgba(47, 107, 255, 0.6);
    }

    .track-play-toggle:active {
      transform: translateY(0);
    }

    .progress-bar-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .progress-bar {
      position: relative;
      width: 100%;
      height: 5px;
      border-radius: 999px;
      background: rgba(86, 97, 140, 0.35);
      overflow: hidden;
      cursor: pointer;
    }

    .progress-bar::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, rgba(76, 112, 255, 0.18), transparent);
    }

    .progress-bar-filled {
      height: 100%;
      border-radius: inherit;
      width: 0;
      background: linear-gradient(90deg, #2f6bff, #3ed39a);
      box-shadow: 0 0 16px rgba(47, 107, 255, 0.35);
    }

    .time-display {
      font-size: 11px;
      color: rgba(192, 199, 228, 0.75);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .track-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .track-action-btn {
      border: 1px solid rgba(95, 124, 220, 0.35);
      color: #dfe4ff;
      background: rgba(15, 18, 34, 0.85);
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      transition: background 180ms ease, color 180ms ease, border-color 180ms ease;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .track-action-btn:hover {
      background: linear-gradient(120deg, rgba(47, 107, 255, 0.25), rgba(30, 208, 160, 0.25));
      border-color: rgba(120, 196, 255, 0.6);
    }

    .track-action-btn[disabled] {
      opacity: 0.5;
      pointer-events: none;
    }


    .mini-player {
      position: fixed;
      right: 28px;
      bottom: 28px;
      width: min(420px, calc(100% - 32px));
      border-radius: 24px;
      background: linear-gradient(140deg, rgba(18, 24, 46, 0.96), rgba(32, 38, 74, 0.96));
      border: 1px solid rgba(92, 128, 248, 0.35);
      box-shadow: 0 30px 60px rgba(6, 10, 28, 0.75);
      padding: 18px 20px;
      z-index: 50;
      opacity: 0;
      pointer-events: none;
      transform: translateY(40px);
      transition: opacity 220ms ease, transform 220ms ease;
      backdrop-filter: blur(14px);
    }

    .mini-player.is-active {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    .mini-player-inner {
      display: grid;
      grid-template-columns: auto 1fr;
      grid-template-areas:
        "track controls"
        "actions actions";
      gap: 16px;
      align-items: center;
    }

    .mini-player-track {
      grid-area: track;
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .mini-player-cover {
      width: 66px;
      height: 66px;
      border-radius: 16px;
      background-size: cover;
      background-position: center;
      background-color: #1c2238;
      box-shadow: 0 14px 24px rgba(23, 33, 70, 0.55);
    }

    .mini-player-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .mini-player-title {
      font-size: 15px;
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    .mini-player-artist {
      font-size: 12px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: rgba(198, 204, 238, 0.75);
    }

    .mini-player-controls {
      grid-area: controls;
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: stretch;
    }

    .mini-player-buttons {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .mini-player-play-btn {
      width: 52px;
      height: 52px;
      border-radius: 16px;
      border: none;
      background: linear-gradient(140deg, #2f6bff, #46d5a0);
      color: #f4f6ff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 24px 40px rgba(32, 178, 170, 0.35);
      transition: transform 180ms ease, box-shadow 180ms ease;
    }

    .mini-player-play-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 26px 50px rgba(72, 178, 255, 0.45);
    }

    .mini-player-progress-wrapper {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 10px;
      align-items: center;
      font-size: 12px;
      color: rgba(194, 202, 232, 0.75);
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .mini-player-progress-wrapper .progress-bar {
      height: 6px;
    }

    .mini-player-actions {
      grid-area: actions;
      display: flex;
      gap: 14px;
      align-items: center;
      justify-content: flex-end;
    }

    .mini-player .track-action-btn {
      font-size: 10px;
      padding: 6px 12px;
    }

    .volume-control {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: rgba(198, 204, 238, 0.7);
      font-size: 14px;
    }

    .volume-slider {
      -webkit-appearance: none;
      appearance: none;
      width: 110px;
      height: 4px;
      border-radius: 999px;
      background: rgba(95, 120, 200, 0.35);
      outline: none;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: linear-gradient(140deg, #2f6bff, #3ed39a);
      box-shadow: 0 0 12px rgba(63, 163, 255, 0.5);
      cursor: pointer;
    }

    .volume-slider::-moz-range-thumb {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: linear-gradient(140deg, #2f6bff, #3ed39a);
      box-shadow: 0 0 12px rgba(63, 163, 255, 0.5);
      border: none;
      cursor: pointer;
    }

    .lyrics-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(4, 6, 12, 0.75);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 200ms ease;
      z-index: 60;
    }

    .lyrics-modal-overlay.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .lyrics-modal {
      background: linear-gradient(160deg, rgba(17, 22, 38, 0.96), rgba(26, 32, 56, 0.96));
      border: 1px solid rgba(90, 120, 210, 0.4);
      border-radius: 22px;
      padding: 28px;
      width: min(540px, calc(100% - 48px));
      box-shadow: 0 40px 70px rgba(5, 8, 20, 0.65);
      position: relative;
      color: #e8ebff;
    }

    .lyrics-modal::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      border: 1px solid rgba(127, 156, 255, 0.35);
      pointer-events: none;
      opacity: 0.6;
    }

    .lyrics-modal.is-yashlek {
      background: radial-gradient(circle at top, rgba(21, 30, 66, 0.95), rgba(8, 12, 28, 0.95));
      border-color: rgba(122, 245, 227, 0.45);
      box-shadow: 0 24px 80px rgba(26, 244, 175, 0.35);
      animation: lyricsGlow 4s ease-in-out infinite;
    }

    .lyrics-modal.is-yashlek::before {
      border-color: rgba(175, 248, 255, 0.35);
      box-shadow: 0 0 32px rgba(108, 249, 255, 0.25);
    }

    .lyrics-title {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 0.04em;
      margin-bottom: 6px;
    }

    .lyrics-artist {
      font-size: 12px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: rgba(198, 204, 238, 0.6);
      margin-bottom: 18px;
    }

    .lyrics-text {
      max-height: 320px;
      overflow-y: auto;
      line-height: 1.6;
      color: rgba(220, 225, 255, 0.9);
      font-size: 14px;
    }

    .lyrics-text.is-yashlek {
      font-size: 15px;
      letter-spacing: 0.02em;
      color: rgba(244, 255, 250, 0.95);
      text-transform: none;
    }

    .lyrics-text::-webkit-scrollbar {
      width: 6px;
    }

    .lyrics-text::-webkit-scrollbar-thumb {
      background: rgba(95, 120, 200, 0.5);
      border-radius: 999px;
    }

    .lyrics-paragraph {
      margin: 0 0 12px;
      font-weight: 500;
      letter-spacing: 0.03em;
    }

    .lyrics-space {
      height: 12px;
    }

    .lyrics-line {
      position: relative;
      padding: 10px 0;
      font-size: 16px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      overflow: hidden;
    }

    .lyrics-line-main {
      position: relative;
      z-index: 2;
    }

    .lyrics-line-ghost {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      color: rgba(108, 255, 226, 0.25);
      transform: translate(6px, 6px);
      z-index: 1;
      transition: opacity 300ms ease, transform 300ms ease;
      pointer-events: none;
    }

    .lyrics-line.is-desync .lyrics-line-ghost {
      opacity: 0.9;
      transform: translate(-6px, -6px);
    }

    @keyframes lyricsGlow {
      0% {
        box-shadow: 0 24px 80px rgba(26, 244, 175, 0.35);
      }
      50% {
        box-shadow: 0 36px 90px rgba(104, 194, 255, 0.45);
      }
      100% {
        box-shadow: 0 24px 80px rgba(26, 244, 175, 0.35);
      }
    }

    .lyrics-close-btn {
      position: absolute;
      top: 16px;
      right: 18px;
      width: 34px;
      height: 34px;
      border-radius: 12px;
      border: none;
      background: rgba(16, 20, 38, 0.85);
      color: #dfe4ff;
      font-size: 24px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: background 180ms ease;
    }

    .lyrics-close-btn:hover {
      background: rgba(47, 107, 255, 0.4);
    }

    @media (max-width: 720px) {
      .profile-wrapper {
        grid-template-columns: 1fr;
      }

      .achievements-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .tracks-gallery-scroller {
        grid-auto-flow: row;
        grid-template-rows: none;
        grid-auto-rows: minmax(0, 1fr);
        grid-auto-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 640px) {
      .track-card {
        flex-direction: column;
        align-items: flex-start;
      }

      .track-cover {
        width: 100%;
        height: 200px;
      }

      .player-controls {
        width: 100%;
      }

      .mini-player {
        right: 16px;
        left: 16px;
        bottom: 18px;
        width: auto;
      }

      .mini-player-inner {
        grid-template-columns: 1fr;
        grid-template-areas:
          "track"
          "controls"
          "actions";
      }

      .mini-player-track {
        justify-content: space-between;
      }

      .mini-player-actions {
        justify-content: space-between;
      }

      .volume-slider {
        width: 90px;
      }
    }

    .news-list {
      display: grid;
      gap: 14px;
    }

    .news-item {
      padding: 12px 14px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: rgba(9, 11, 21, 0.9);
      box-shadow: 0 9px 20px rgba(0, 0, 0, 0.6);
      position: relative;
      overflow: hidden;
    }

    .news-item::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0 0, rgba(68, 115, 255, 0.15), transparent 60%);
      opacity: 0.8;
      pointer-events: none;
    }

    .news-tag {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #9fb1ff;
      margin-bottom: 4px;
    }

    .news-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .news-meta {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .news-text {
      font-size: 13px;
      color: #c5c9dd;
    }

    .about-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1.4fr);
      gap: 24px;
    }

    .about-text {
      font-size: 14px;
      color: var(--muted);
    }

    .about-text p + p {
      margin-top: 10px;
    }

    .socials {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 14px;
    }

    .social-pill {
      font-size: 12px;
      border-radius: 999px;
      padding: 7px 12px;
      border: 1px solid var(--border);
      color: var(--muted);
      background: rgba(9, 12, 24, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .about-card {
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      background: radial-gradient(circle at top, rgba(47, 107, 255, 0.18), rgba(5, 6, 12, 0.96));
      padding: 16px 18px;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .about-card-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #d4ddff;
    }

    .about-card-stat-row {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      color: #c1c7e6;
    }

    .about-card-stat-row span:last-child {
      color: #f8f8ff;
      font-weight: 600;
    }

    footer {
      margin-top: 24px;
      padding-top: 18px;
      border-top: 1px solid #1a1f30;
      font-size: 11px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    @media (max-width: 720px) {
      .header-actions {
        width: 100%;
        justify-content: flex-start;
      }

      .hero {
        align-items: flex-start;
      }

      .hero-left {
        flex-direction: row;
      }
    }

    @media (max-width: 520px) {
      .hero-left {
        flex-direction: row;
      }

      .hero-actions {
        flex-direction: column;
        align-items: stretch;
      }

      .btn,
      .btn-ghost {
        justify-content: center;
        width: 100%;
      }
    }

    @media (max-width: 720px) {
      header {
        align-items: center;
      }

      nav {
        position: absolute;
        inset-inline: 16px;
        top: 60px;
        background: rgba(5, 7, 16, 0.98);
        border-radius: 14px;
        border: 1px solid var(--border);
        box-shadow: var(--shadow-soft);
        padding: 10px 14px 12px;
        flex-direction: column;
        gap: 10px;
        transform-origin: top right;
        transform: scaleY(0.8);
        opacity: 0;
        pointer-events: none;
        transition: opacity 160ms ease-out, transform 160ms ease-out;
        z-index: 20;
      }

      nav.nav-open {
        opacity: 1;
        pointer-events: auto;
        transform: scaleY(1);
      }

      .nav-toggle {
        display: inline-flex;
      }
    }

    @media (max-width: 520px) {
      .hero-actions {
        flex-direction: column;
        align-items: stretch;
      }

      .btn,
      .btn-ghost {
        justify-content: center;
        width: 100%;
      }

      .section-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="logo-group">
        <div class="logo-mark">Ø</div>
        <div class="logo-text">
          <div class="logo-text-main">AVZALØV</div>
          <div class="logo-text-sub">Рузиль Авзалов</div>
        </div>
      </div>

      <button class="nav-toggle" id="navToggle" aria-label="Меню">
        ☰
      </button>

      <nav id="mainNav">
        <a href="#tracks">Релизы</a>
        <a href="#news">Новости</a>
        <a href="#about">Биография</a>
        <a href="#contacts">Контакты</a>
      </nav>
      <div class="header-actions">
        <div class="header-action-group">
          <button
            class="ruzcoin-chip"
            id="headerCoinsBtn"
            type="button"
            aria-haspopup="dialog"
            aria-expanded="false"
          >
            <div class="ruzcoin-icon" aria-hidden="true">RZ</div>
            <div class="ruzcoin-info">
              <span class="ruzcoin-label">RUZCOIN</span>
              <span class="ruzcoin-value" id="headerCoinsAmount">0</span>
            </div>
          </button>
          <div class="header-popover coins-popover" id="headerCoinsPopover" role="dialog" aria-hidden="true">
            <div class="popover-header">
              <div class="popover-title">RUZCOIN</div>
              <div class="popover-sub">1 RUZCOIN = <span id="ruzcoinPriceValue">10 ₽</span></div>
            </div>
            <p class="popover-text">
              Пополнение и способы оплаты находятся в разработке. Мы уведомим тебя, когда появится возможность купить
              монеты напрямую.
            </p>
            <div class="popover-actions">
              <button class="btn btn-primary btn-xs" type="button" disabled>
                Пополнить
                <span class="chip-soon">Скоро</span>
              </button>
              <button class="btn btn-ghost btn-xs" type="button" id="coinsInfoBtn">
                Узнать подробнее
              </button>
            </div>
            <div class="popover-footnote">
              В профиле ты увидишь историю начислений RUZCOIN и бонусы за активность.
            </div>
          </div>
        </div>
        <div class="header-action-group">
          <button
            class="header-profile-btn"
            id="headerProfileBtn"
            type="button"
            aria-haspopup="dialog"
            aria-expanded="false"
          >
            <i class="fas fa-user"></i>
            <span id="headerProfileName">Войти</span>
          </button>
          <div class="header-popover profile-popover" id="headerProfilePopover" role="dialog" aria-hidden="true">
            <div class="profile-popover-section" data-state="logged-out">
              <div class="popover-header">
                <div class="popover-title">Вход в профиль</div>
                <div class="popover-sub">Получи 10 RUZCOIN за первое подключение</div>
              </div>
              <form id="loginForm" class="popover-form">
                <label for="loginName" class="sr-only">Никнейм</label>
                <input type="text" id="loginName" placeholder="Твой ник" autocomplete="nickname" required />
                <label for="loginPassword" class="sr-only">Пароль</label>
                <input type="password" id="loginPassword" placeholder="Пароль" autocomplete="new-password" required />
                <button type="submit" class="btn btn-primary btn-sm">Войти</button>
              </form>
              <details class="admin-login" id="adminLoginToggle">
                <summary>Войти по коду администратора</summary>
                <form id="adminCodeForm" class="popover-form">
                  <label for="adminCodeInput" class="sr-only">Уникальный код</label>
                  <input type="text" id="adminCodeInput" placeholder="AVZ-ADMIN-000" autocomplete="one-time-code" required />
                  <label for="adminNameInput" class="sr-only">Имя</label>
                  <input type="text" id="adminNameInput" placeholder="Отображаемое имя" autocomplete="nickname" />
                  <button type="submit" class="btn btn-primary btn-sm">Активировать код</button>
                </form>
              </details>
            </div>
            <div class="profile-popover-section" data-state="logged-in">
              <div class="popover-header">
                <div class="popover-title" id="popoverProfileName">Гость</div>
                <div class="popover-sub">ID: <span id="popoverProfileId">—</span></div>
              </div>
              <div class="popover-balance">
                <span class="ruzcoin-icon is-inline" aria-hidden="true">RZ</span>
                <div>
                  <div class="popover-meta">Баланс</div>
                  <div class="popover-balance-value" id="popoverCoinsAmount">0</div>
                </div>
              </div>
              <div class="popover-meta">Роль: <span id="popoverProfileRole">Слушатель</span></div>
              <div class="popover-actions">
                <button class="btn btn-primary btn-xs" type="button" id="openProfileSectionBtn">Профиль</button>
                <button class="btn btn-ghost btn-xs" type="button" data-action="logout">Выход</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <section class="hero">
      <div class="hero-left">
        <div class="hero-avatar">
          <div class="hero-avatar-label">AVZALØV</div>
        </div>
        <div class="hero-main">
          <div class="hero-subtitle">
            артист • продюсер • <span>Рузиль Авзалов</span>
          </div>
          <h1 class="hero-title">AVZALØV</h1>
          <p class="hero-text">
            AVZALØV (Рузиль Авзалов) — артист, сочетающий тёмные баллады,
            экспериментальный поп и эмоциональные истории о вере,
            молодости и внутренней борьбе.
          </p>

          <div class="hero-tags">
            <div class="tag">дарк-поп</div>
            <div class="tag">альт-рэп</div>
            <div class="tag">эмоциональный</div>
            <div class="tag">ru / tt</div>
          </div>

          <div class="hero-actions">
            <button class="btn btn-primary" onclick="document.getElementById('tracks').scrollIntoView({behavior:'smooth'})">
              Слушать релизы
            </button>
            <button class="btn btn-ghost" onclick="document.getElementById('contacts').scrollIntoView({behavior:'smooth'})">
              Связаться
            </button>
          </div>
        </div>
      </div>
    </section>

    <section id="profile">
      <div class="section-header">
        <h2 class="section-title">Профиль</h2>
        <p class="section-sub">
          Личный кабинет, RUZCOIN и доступ к закрытым трекам.
        </p>
      </div>

      <div class="profile-wrapper">
        <div class="profile-panel" id="profilePanel" hidden>
          <div class="profile-main">
            <div class="profile-avatar"></div>
            <div class="profile-info">
              <div class="profile-name" id="profileName">Гость</div>
              <div class="profile-id">ID: <span id="profileId">—</span></div>
              <div class="profile-role">Роль: <span id="profileRole">Слушатель</span></div>
              <div class="profile-coins">
                <span class="ruzcoin-icon is-inline" aria-hidden="true">RZ</span>
                Баланс RUZCOIN:
                <span class="coins-amount" id="coinsAmount">0</span>
              </div>
              <div class="profile-actions-row">
                <button class="btn btn-primary btn-xs" id="earnDemoCoinsBtn">+5 RUZCOIN (демо)</button>
                <button class="btn btn-ghost btn-xs" id="profileTopupBtn" type="button">
                  Пополнение
                  <span class="chip-soon">В разработке</span>
                </button>
                <button class="btn btn-ghost btn-xs" id="logoutBtn" type="button" data-action="logout">Выход</button>
              </div>
            </div>
          </div>

          <div class="profile-achievements">
            <h4>Достижения</h4>
            <div class="achievements-grid" id="achievementsGrid"></div>
          </div>
        </div>

        <div class="profile-empty" id="profileEmpty">
          <h3>Войдите через меню в правом верхнем углу</h3>
          <p>
            После входа здесь появится подробный профиль с балансом RUZCOIN, достижениями и доступом к эксклюзивным трекам.
            Первое подключение подарит 10 RUZCOIN.
          </p>
        </div>
      </div>
    </section>

    <section id="tracks">
      <div class="section-header">
        <h2 class="section-title">Релизы</h2>
        <p class="section-sub">
          Все синглы, EP и альбомы.
        </p>
      </div>

      <div class="tracks-grid">
      </div>
    </section>

    <section id="news">
      <div class="section-header">
        <h2 class="section-title">Новости</h2>
        <p class="section-sub">
          Свежие анонсы, релизы и важные события.
        </p>
      </div>

      <div class="news-list">
        <article class="news-item">
          <div class="news-tag" style="color: #2ed58b;">анонс</div>
          <div class="news-title">«ДИКАЯ КОМЕТА» выходит 28 ноября</div>
          <div class="news-meta">Ноябрь 2025</div>
          <p class="news-text">
            Новый сингл AVZALØV уже на подходе — включите уведомления и приготовьтесь к премьерному запуску 28.11.2025.
          </p>
        </article>
        
        <article class="news-item">
          <div class="news-tag">анонс</div>
          <div class="news-title">Готовится новый мини-альбом</div>
          <div class="news-meta">Дата выхода будет объявлена позже</div>
          <p class="news-text">
            В треклист войдут темные баллады на русском и татарском языках, а также совместные работы с другими артистами.
          </p>
        </article>
      </div>
    </section>

    <section id="about">
      <div class="section-header">
        <h2 class="section-title">Обо мне</h2>
        <p class="section-sub">
          Немного о том, кто такой AVZALØV (Рузиль Авзалов).
        </p>
      </div>

      <div class="about-grid">
        <div class="about-text">
          <p>
            AVZALØV (Рузиль Авзалов) — артист и автор песен, который объединяет в своей музыке мрачные атмосферы, искренние тексты и кинематографичный звук. Темы треков — вера, поиск себя, молодость, внутренние раны и надежда.
          </p>
          <p>
            В песнях звучат русский и татарский языки, а звучание балансирует между dark pop, альтернативным рэпом и эмоциональными балладами.
          </p>

          <div class="socials">
            <a href="https://vk.com/artist/avzalov" target="_blank" class="social-pill">VK Music</a>
            <a href="https://music.youtube.com/" target="_blank" class="social-pill">YouTube Music</a>
            <a href="https://open.spotify.com/artist/" target="_blank" class="social-pill">Spotify</a>
            <a href="https://t.me/your_nick" target="_blank" class="social-pill">Telegram</a>
          </div>
        </div>

        <aside class="about-card">
          <div class="about-card-title">Цифры и факты</div>
          <div class="about-card-stat-row">
            <span>Релизов</span>
            <span>10+</span>
          </div>
          <div class="about-card-stat-row">
            <span>Прослушиваний</span>
            <span>100K+</span>
          </div>
          <div class="about-card-stat-row">
            <span>Города слушателей</span>
            <span>20+</span>
          </div>
        </aside>
      </div>
    </section>

    <section id="contacts">
      <div class="section-header">
        <h2 class="section-title">Контакты</h2>
        <p class="section-sub">
          Для концертов, коллабораций, плейлистов и других предложений.
        </p>
      </div>

      <div class="about-text">
        <p>
          По вопросам сотрудничества и выступлений:
        </p>
        <p style="margin-top:8px;">
          Email: <a href="mailto:booking@avzalov.com" style="color: var(--accent);">booking@avzalov.com</a><br />
          Telegram: <a href="https://t.me/your_nick" target="_blank" style="color: var(--accent);">@your_nick</a>
        </p>
      </div>
    </section>

    <footer>
      <span>© <span id="year"></span> AVZALØV (Рузиль Авзалов).</span>
      <span>Официальный сайт артиста.</span>
    </footer>
  </div>

  <!-- NEW Mini Player -->
  <div class="mini-player" id="miniPlayer">
    <div class="mini-player-inner">
      <div class="mini-player-track">
        <div class="mini-player-cover" id="miniPlayerCover"></div>
        <div class="mini-player-info">
          <div class="mini-player-title" id="miniPlayerTitle">Название трека</div>
          <div class="mini-player-artist">AVZALØV</div>
        </div>
      </div>
      <div class="mini-player-controls">
        <div class="mini-player-buttons">
          <button class="mini-player-play-btn" id="miniPlayerPlayBtn"><i class="fas fa-play"></i></button>
        </div>
        <div class="mini-player-progress-wrapper">
          <span id="miniPlayerCurrentTime">0:00</span>
          <div class="progress-bar" id="miniPlayerProgressBar"><div class="progress-bar-filled" id="miniPlayerProgressFilled"></div></div>
          <span id="miniPlayerDuration">0:00</span>
        </div>
      </div>
      <div class="mini-player-actions">
        <button class="track-action-btn" id="miniPlayerLyricsBtn">Текст</button>
        <div class="volume-control">
          <i class="fas fa-volume-down"></i>
          <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.01" value="1">
        </div>
      </div>
    </div>
  </div>

  <!-- Lyrics Modal -->
  <div class="lyrics-modal-overlay" id="lyricsModalOverlay">
    <div class="lyrics-modal">
      <button class="lyrics-close-btn" id="lyricsCloseBtn">&times;</button>
      <h3 class="lyrics-title" id="lyricsModalTitle"></h3>
      <p class="lyrics-artist">AVZALØV</p>
      <div class="lyrics-text" id="lyricsModalText"></div>
    </div>
  </div>

  <script src="tracks-data.js"></script>
  <script>
    const navToggle = document.getElementById("navToggle");
    const mainNav = document.getElementById("mainNav");
    const headerProfileBtn = document.getElementById("headerProfileBtn");
    const headerProfileNameEl = document.getElementById("headerProfileName");
    const headerCoinsAmountEl = document.getElementById("headerCoinsAmount");
    const headerTopupBtn = document.getElementById("headerTopupBtn");
    const profileTopupBtn = document.getElementById("profileTopupBtn");

    if (navToggle && mainNav) {
      navToggle.addEventListener("click", () => {
        mainNav.classList.toggle("nav-open");
      });
    }

    if (headerProfileBtn) {
      headerProfileBtn.addEventListener("click", () => {
        const profileSection = document.getElementById("profile");
        if (profileSection) {
          profileSection.scrollIntoView({ behavior: "smooth" });
        }
      });
    }

    function notifyTopupInProgress() {
      alert("Пополнение RUZCOIN находится в разработке.");
    }

    [headerTopupBtn, profileTopupBtn].forEach(btn => {
      if (btn) {
        btn.addEventListener("click", event => {
          event.preventDefault();
          notifyTopupInProgress();
        });
      }
    });

    document.getElementById("year").textContent = new Date().getFullYear();
    const numberFormatter = new Intl.NumberFormat("ru-RU");

    const releasedCarousel = document.getElementById("releasedCarousel");
    const tracksGrid = document.querySelector("#tracks .tracks-grid");
    const releasedTracksConfig = Array.isArray(window.RELEASED_TRACKS_DATA)
      ? window.RELEASED_TRACKS_DATA
      : [];
    const releaseReferenceDate = resolveReferenceDate();
    const tracksGalleryScroller = document.getElementById("tracksGalleryScroller");
    const tracksGalleryFilters = document.getElementById("tracksGalleryFilters");
    const availabilityLabelMap = {
      public: "Открыто",
      "early-access": "Ранний доступ",
      upcoming: "Ожидается"
    };

    function resolveReferenceDate() {
      const manual = typeof window.RELEASES_TODAY === "string" ? window.RELEASES_TODAY.trim() : "";
      if (manual) {
        const parsed = new Date(manual);
        if (!Number.isNaN(parsed.getTime())) {
          return parsed;
        }
      }
      return new Date();
    }

    function parseReleaseDate(value) {
      if (typeof value !== "string") {
        return null;
      }
      const trimmed = value.trim();
      if (!trimmed || trimmed.toLowerCase() === "скоро") {
        return null;
      }
      const segments = trimmed.split(".");
      if (segments.length === 3) {
        const [day, month, year] = segments.map(part => Number.parseInt(part, 10));
        if (!Number.isNaN(day) && !Number.isNaN(month) && !Number.isNaN(year)) {
          const parsed = new Date(year, month - 1, day);
          if (!Number.isNaN(parsed.getTime())) {
            return parsed;
          }
        }
      }
      const fallback = new Date(trimmed);
      return Number.isNaN(fallback.getTime()) ? null : fallback;
    }

    function determineReleaseState(parsedDate) {
      if (!parsedDate) {
        return "soon";
      }
      return parsedDate.getTime() <= releaseReferenceDate.getTime() ? "released" : "soon";
    }

    function determineVisualStatus(typeLabel, releaseState) {
      const normalizedType = (typeLabel || "").toLowerCase();
      if (normalizedType.includes("ep") || normalizedType.includes("альбом")) {
        return "ep";
      }
      return releaseState === "soon" ? "soon" : "released";
    }

    function resolveAvailability(accessValue, releaseState, trackConfig = {}) {
      const normalized = typeof accessValue === "string" ? accessValue.trim().toLowerCase() : "";
      if (normalized && Object.prototype.hasOwnProperty.call(availabilityLabelMap, normalized)) {
        return normalized;
      }
      if (releaseState === "released") {
        return "public";
      }
      if (trackConfig && trackConfig.unlockable === false) {
        return "upcoming";
      }
      return "early-access";
    }

    function formatAvailabilityLabel(value) {
      return availabilityLabelMap[value] || availabilityLabelMap.public;
    }

    function buildCoverBackgroundValue(fileBase) {
      const normalized = (fileBase || "").trim();
      const gradientFallback = "linear-gradient(140deg, rgba(38, 52, 110, 0.85), rgba(12, 16, 32, 0.9))";
      if (!normalized) {
        return gradientFallback;
      }
      const sources = [".webp", ".jpg", ".jpeg", ".png"].map(ext => {
        const path = encodeURI(`img/${normalized}${ext}`);
        return `url('${path}')`;
      });
      sources.push(gradientFallback);
      return sources.join(", ");
    }

    function buildAudioSource(fileBase, customExt) {
      const normalized = (fileBase || "").trim();
      const ext = customExt || ".mp3";
      if (!normalized) {
        return "";
      }
      return encodeURI(`audio/${normalized}${ext}`);
    }

    function buildTrackLibrary() {
      return releasedTracksConfig.map((trackConfig, index) => {
        const slug = (trackConfig.slug || trackConfig.file || `track-${index}`).trim();
        const releaseRaw = trackConfig.releaseDate ? String(trackConfig.releaseDate).trim() : "";
        const parsedDate = parseReleaseDate(releaseRaw);
        const releaseState = determineReleaseState(parsedDate);
        const typeLabel = (trackConfig.type || "Сингл").trim() || "Сингл";
        const visualStatus = determineVisualStatus(typeLabel, releaseState);
        const availability = resolveAvailability(trackConfig.access, releaseState, trackConfig);
        const availabilityLabel = formatAvailabilityLabel(availability);
        const coverBase = (trackConfig.cover || slug).trim();
        const audioBase = (trackConfig.audio || slug).trim();
        const audioSource = buildAudioSource(audioBase, trackConfig.audioExt);
        const previewAllowed = trackConfig.preview === true || trackConfig.alwaysPlayable === true;
        const hasAudio = Boolean(audioSource) && (releaseState === "released" || previewAllowed);
        const hasExactReleaseDate = Boolean(parsedDate);
        const releaseTimeline = releaseState === "released"
          ? "released"
          : hasExactReleaseDate
            ? "scheduled"
            : "no-date";
        const releaseLabel = (() => {
          if (releaseRaw && releaseRaw.toLowerCase() !== "скоро") {
            return releaseState === "soon" ? `Скоро • ${releaseRaw}` : releaseRaw;
          }
          return releaseState === "released" ? "Уже в сети" : "Скоро";
        })();
        const releaseDateValue = parsedDate ? parsedDate.getTime() : null;
        return {
          slug,
          title: trackConfig.title || slug,
          typeLabel,
          releaseLabel,
          releaseState,
          visualStatus,
          availability,
          releaseTimeline,
          hasExactReleaseDate,
          availabilityLabel,
          releaseDateValue,
          releaseRaw,
          likes: 2100 + index * 47,
          plays: 130000 + index * 6100,
          coverStyle: buildCoverBackgroundValue(coverBase),
          audio: hasAudio ? audioSource : "",
          hasAudio,
          streamUrl: trackConfig.streamUrl || (hasAudio ? audioSource : "#"),
          lyrics: trackConfig.lyrics || null
        };
      });
    }

    function sortTrackLibrary(tracks) {
      return tracks
        .slice()
        .sort((a, b) => {
          if (a.releaseState !== b.releaseState) {
            return a.releaseState === "released" ? -1 : 1;
          }
          const aTime = typeof a.releaseDateValue === "number"
            ? a.releaseDateValue
            : a.releaseState === "released"
              ? -Infinity
              : Infinity;
          const bTime = typeof b.releaseDateValue === "number"
            ? b.releaseDateValue
            : b.releaseState === "released"
              ? -Infinity
              : Infinity;
          if (aTime !== bTime) {
            if (a.releaseState === 'released') {
              return bTime - aTime;
            }
            return aTime - bTime;
          }
          return a.title.localeCompare(b.title, "ru", { sensitivity: "base" });
        });
    }

    function buildTrackDivider(label, metaText) {
      const divider = document.createElement("div");
      divider.className = "track-divider";
      if (metaText) {
        divider.innerHTML = `${label} <span class="track-divider-meta">${metaText}</span>`;
      } else {
        divider.textContent = label;
      }
      return divider;
    }

    function createTrackCard(track) {
      const article = document.createElement("article");
      article.className = "track-card";
      if (track.slug) {
        article.dataset.trackSlug = track.slug;
      }
      article.dataset.likes = track.likes;
      article.dataset.plays = track.plays;
      article.dataset.releaseState = track.releaseState;
      article.dataset.status = track.visualStatus;
      article.dataset.availability = track.availability;
      article.dataset.hasAudio = track.hasAudio ? "true" : "false";
      if (!track.hasAudio) {
        article.classList.add("track-locked");
      }
      const playerControlsClass = track.hasAudio ? "player-controls" : "player-controls is-disabled";
      const playButtonAttributes = track.hasAudio
        ? 'class="track-play-toggle" type="button" aria-label="Воспроизвести трек"'
        : 'class="track-play-toggle" type="button" aria-label="Предпрослушивание недоступно" disabled';
      const listenAction = track.hasAudio
        ? `<a href="${track.streamUrl}" target="_blank" class="track-action-btn"><i class="fas fa-headphones"></i><span>Слушать</span></a>`
        : track.availability === "early-access"
          ? '<button class="track-action-btn" type="button" disabled><i class="fas fa-lock"></i><span>Оформить доступ</span></button>'
          : '<button class="track-action-btn" type="button" disabled><i class="fas fa-headphones"></i><span>Скоро</span></button>';
      const audioMarkup = track.hasAudio
        ? `<audio class="track-audio" src="${track.audio}" preload="metadata"></audio>`
        : '';
      article.innerHTML = `
        <div class="track-cover" style="background-image:${track.coverStyle};">
          <div class="play-overlay"><i class="fas fa-play"></i></div>
        </div>
        <div class="track-info">
          <div class="track-title-row">
            <div class="track-title">${track.title}</div>
            <span class="track-badge ${track.availability}">${track.availabilityLabel}</span>
          </div>
          <div class="track-meta">
            <span>${track.typeLabel}</span>
            <span class="dot"></span>
            <span>${track.releaseLabel}</span>
          </div>
          <div class="track-stats">
            <button class="track-like-btn" type="button" aria-label="Понравилось" aria-pressed="false">
              <i class="fas fa-heart"></i>
              <span class="track-like-count">${formatCount(track.likes)}</span>
            </button>
            <div class="track-plays" aria-label="Количество прослушиваний">
              <i class="fas fa-chart-line"></i>
              <span class="track-plays-count">${formatCount(track.plays)}</span>
            </div>
          </div>
          <div class="${playerControlsClass}">
            <button ${playButtonAttributes}>
              <i class="fas fa-play"></i>
            </button>
            <div class="progress-bar-wrapper">
              <div class="progress-bar"><div class="progress-bar-filled"></div></div>
              <span class="time-display">${track.hasAudio ? '0:00 / 0:00' : 'Скоро'}</span>
            </div>
          </div>
        <div class="track-actions">
          <button class="track-action-btn lyrics-btn"><i class="fas fa-align-left"></i><span>Текст</span></button>
          ${listenAction}
        </div>
      </div>
      ${audioMarkup}
      <div class="lyrics-content" style="display: none;"></div>
      `;
      const lyricsContainer = article.querySelector(".lyrics-content");
      if (lyricsContainer && Array.isArray(track.lyrics) && track.lyrics.length > 0) {
        lyricsContainer.textContent = track.lyrics.join("\\n");
      }
      return article;
    }

    function renderTracksGrid(tracks) {
      if (!tracksGrid) {
        return;
      }
      tracksGrid.innerHTML = '';
      const dateFormatter = new Intl.DateTimeFormat('ru-RU', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });
      const groups = [
        {
          label: 'Доступно сейчас',
          filter: track => track.releaseTimeline === 'released',
          buildMeta: matches => matches.length ? `в сети • всего: ${matches.length}` : ''
        },
        {
          label: 'Ранний доступ',
          filter: track => track.releaseTimeline === 'no-date',
          buildMeta: matches => matches.length ? `без даты • всего: ${matches.length}` : ''
        },
        {
          label: 'Ожидаются',
          filter: track => track.releaseTimeline === 'scheduled',
          buildMeta: matches => {
            if (!matches.length) {
              return '';
            }
            const metaParts = [];
            const scheduled = matches
              .filter(track => Number.isFinite(track.releaseDateValue))
              .sort((a, b) => a.releaseDateValue - b.releaseDateValue);
            if (scheduled.length) {
              const firstDate = dateFormatter.format(new Date(scheduled[0].releaseDateValue));
              metaParts.push(`ближайшая: ${firstDate}`);
            }
            metaParts.push(`всего: ${matches.length}`);
            return metaParts.join(' • ');
          }
        }
      ];
      let renderedAny = false;
      groups.forEach(group => {
        const matches = tracks.filter(group.filter);
        if (!matches.length) {
          return;
        }
        renderedAny = true;
        const metaText = typeof group.buildMeta === 'function' ? group.buildMeta(matches) : '';
        tracksGrid.appendChild(buildTrackDivider(group.label, metaText));
        matches.forEach(track => {
          tracksGrid.appendChild(createTrackCard(track));
        });
      });
      if (!renderedAny) {
        const placeholder = document.createElement('p');
        placeholder.className = 'section-sub';
        placeholder.textContent = 'Нет релизов для отображения.';
        tracksGrid.appendChild(placeholder);
      }
    }

    function renderReleasedTracks(tracks) {
      if (!releasedCarousel) {
        return;
      }
      releasedCarousel.innerHTML = '';
      const fragment = document.createDocumentFragment();
      tracks
        .filter(track => track.releaseState === 'released')
        .forEach(track => {
          fragment.appendChild(createTrackCard(track));
        });
      releasedCarousel.appendChild(fragment);
    }
    function escapeSlugForSelector(value) {
      if (!value) {
        return "";
      }
      if (typeof CSS !== "undefined" && typeof CSS.escape === "function") {
        return CSS.escape(value);
      }
      return value.replace(/(["'\\])/g, "\\$1");
    }

    function focusTrackCard(slug) {
      if (!slug) {
        return;
      }
      const selector = `.track-card[data-track-slug="${escapeSlugForSelector(slug)}"]`;
      const target = document.querySelector(selector);
      if (!target) {
        return;
      }
      document
        .querySelectorAll('.track-card.is-highlighted')
        .forEach(card => {
          if (card !== target) {
            card.classList.remove('is-highlighted');
          }
        });
      target.classList.add('is-highlighted');
      target.scrollIntoView({ behavior: 'smooth', block: 'center' });
      window.setTimeout(() => {
        target.classList.remove('is-highlighted');
      }, 1800);
    }

    function createGalleryCard(track) {
      const button = document.createElement('button');
      button.type = 'button';
      button.className = 'mini-gallery-card';
      if (track.slug) {
        button.dataset.trackSlug = track.slug;
      }
      button.innerHTML = `
        <div class="mini-gallery-cover" style="background-image:${track.coverStyle};"></div>
        <div class="mini-gallery-body">
          <div class="mini-gallery-name">${track.title}</div>
          <div class="mini-gallery-meta">
            <span>${track.typeLabel}</span>
            <span class="dot"></span>
            <span>${track.releaseLabel}</span>
          </div>
          <span class="mini-gallery-badge ${track.availability}">${track.availabilityLabel}</span>
        </div>
      `;
      button.addEventListener('click', () => focusTrackCard(track.slug));
      return button;
    }

    function filterTracksForGallery(tracks, filterKey) {
      switch (filterKey) {
        case 'released':
          return tracks.filter(track => track.releaseTimeline === 'released');
        case 'early-access':
          return tracks.filter(track =>
            track.releaseTimeline === 'no-date' ||
            (track.availability === 'early-access' && track.releaseTimeline !== 'released')
          );
        case 'upcoming':
          return tracks.filter(track => track.releaseTimeline === 'scheduled');
        default:
          return tracks;
      }
    }

    function setupTracksGallery(tracks) {
      if (!tracksGalleryScroller) {
        return;
      }
      const filters = [
        { key: 'all', label: 'Все' },
        { key: 'released', label: 'Вышли' },
        { key: 'early-access', label: 'Ранний доступ' },
        { key: 'upcoming', label: 'Ожидаются' }
      ];
      let activeFilter = 'all';

      function renderFilters() {
        if (!tracksGalleryFilters) {
          return;
        }
        tracksGalleryFilters.innerHTML = '';
        filters.forEach(filter => {
          const button = document.createElement('button');
          button.type = 'button';
          button.className = 'mini-gallery-filter';
          button.textContent = filter.label;
          if (filter.key === activeFilter) {
            button.classList.add('is-active');
          }
          button.addEventListener('click', () => {
            if (activeFilter === filter.key) {
              return;
            }
            activeFilter = filter.key;
            renderFilters();
            renderItems();
          });
          tracksGalleryFilters.appendChild(button);
        });
      }

      function renderItems() {
        tracksGalleryScroller.innerHTML = '';
        const filtered = filterTracksForGallery(tracks, activeFilter);
        if (!filtered.length) {
          const placeholder = document.createElement('div');
          placeholder.className = 'mini-gallery-empty';
          placeholder.textContent = 'Нет треков для отображения.';
          tracksGalleryScroller.appendChild(placeholder);
          return;
        }
        filtered.forEach(track => {
          tracksGalleryScroller.appendChild(createGalleryCard(track));
        });
        if (typeof tracksGalleryScroller.scrollTo === 'function') {
          tracksGalleryScroller.scrollTo({ left: 0, behavior: 'smooth' });
        } else {
          tracksGalleryScroller.scrollLeft = 0;
        }
      }

      renderFilters();
      renderItems();
    }

    function updateLyricsModalTheme(slug) {
      const isYashlek = slug === LYRICS_DESYNC_SLUG;
      if (lyricsModal) {
        lyricsModal.classList.toggle("is-yashlek", isYashlek);
      }
      if (lyricsModalText) {
        lyricsModalText.classList.toggle("is-yashlek", isYashlek);
      }
    }

    function renderLyricsBody(rawText, slug) {
      if (!lyricsModalText) {
        return;
      }
      const lines = rawText.split(/\r?\n/);
      const fragment = document.createDocumentFragment();
      lines.forEach(line => {
        const trimmed = line.trim();
        if (!trimmed) {
          const spacer = document.createElement("div");
          spacer.className = "lyrics-space";
          fragment.appendChild(spacer);
          return;
        }
        if (slug === LYRICS_DESYNC_SLUG) {
          const lineEl = document.createElement("div");
          lineEl.className = "lyrics-line";
          const main = document.createElement("span");
          main.className = "lyrics-line-main";
          main.textContent = trimmed;
          const ghost = document.createElement("span");
          ghost.className = "lyrics-line-ghost";
          ghost.textContent = trimmed;
          lineEl.append(main, ghost);
          fragment.appendChild(lineEl);
        } else {
          const paragraph = document.createElement("p");
          paragraph.className = "lyrics-paragraph";
          paragraph.textContent = trimmed;
          fragment.appendChild(paragraph);
        }
      });
      lyricsModalText.innerHTML = "";
      lyricsModalText.appendChild(fragment);
      lyricsModalText.scrollTop = 0;
    }

    function stopLyricsDesync(clearState = true) {
      if (lyricsDesyncTimer) {
        clearInterval(lyricsDesyncTimer);
        lyricsDesyncTimer = null;
      }
      if (clearState && lyricsModalText) {
        lyricsModalText
          .querySelectorAll(".lyrics-line")
          .forEach(line => line.classList.remove("is-desync"));
      }
    }

    function startLyricsDesync() {
      if (!lyricsModalText) {
        return;
      }
      const lines = Array.from(lyricsModalText.querySelectorAll(".lyrics-line"));
      if (!lines.length) {
        return;
      }
      stopLyricsDesync(false);
      lyricsDesyncTimer = window.setInterval(() => {
        const randomLine = lines[Math.floor(Math.random() * lines.length)];
        randomLine.classList.add("is-desync");
        window.setTimeout(() => randomLine.classList.remove("is-desync"), 900);
      }, 1200);
    }

    function updateLyricsDesyncState() {
      if (
        lyricsModalOverlay.classList.contains("visible") &&
        lyricsActiveSlug === LYRICS_DESYNC_SLUG &&
        lyricsActiveCard &&
        lyricsActiveCard.classList.contains("playing")
      ) {
        startLyricsDesync();
      } else {
        stopLyricsDesync();
      }
    }

    function closeLyricsModal() {
      if (!lyricsModalOverlay.classList.contains("visible")) {
        return;
      }
      lyricsModalOverlay.classList.remove("visible");
      lyricsModalOverlay.dataset.activeSlug = "";
      lyricsActiveCard = null;
      lyricsActiveSlug = "";
      stopLyricsDesync();
    }

    const trackLibrary = sortTrackLibrary(buildTrackLibrary());
    renderTracksGrid(trackLibrary);
    renderReleasedTracks(trackLibrary);
    setupTracksGallery(trackLibrary);

    const carouselButtons = document.querySelectorAll("[data-carousel-target]");
    carouselButtons.forEach(button => {
      const targetId = button.dataset.carouselTarget;
      const direction = button.dataset.carouselDirection === "next" ? 1 : -1;
      button.addEventListener("click", () => {
        const carousel = document.getElementById(targetId);
        if (!carousel) {
          return;
        }
        const step = carousel.clientWidth ? carousel.clientWidth * 0.85 : 320;
        carousel.scrollBy({ left: step * direction, behavior: "smooth" });
      });
    });

    const trackCards = document.querySelectorAll(".track-card");
    const lyricsModal = document.querySelector(".lyrics-modal");
    const prefersReducedMotion =
      typeof window.matchMedia === "function"
        ? window.matchMedia("(prefers-reduced-motion: reduce)")
        : { matches: false };
    const miniPlayer = document.getElementById("miniPlayer");
    const miniPlayerCover = document.getElementById("miniPlayerCover");
    const miniPlayerTitle = document.getElementById("miniPlayerTitle");
    const miniPlayerPlayBtn = document.getElementById("miniPlayerPlayBtn");
    const miniPlayerPlayIcon = miniPlayerPlayBtn.querySelector("i");
    const miniPlayerCurrentTime = document.getElementById("miniPlayerCurrentTime");
    const miniPlayerDuration = document.getElementById("miniPlayerDuration");
    const miniPlayerProgressBar = document.getElementById("miniPlayerProgressBar");
    const miniPlayerProgressFilled = document.getElementById("miniPlayerProgressFilled");
    const miniPlayerLyricsBtn = document.getElementById("miniPlayerLyricsBtn");
    const volumeSlider = document.getElementById("volumeSlider");
    const lyricsModalOverlay = document.getElementById("lyricsModalOverlay");
    const lyricsModalTitle = document.getElementById("lyricsModalTitle");
    const lyricsModalText = document.getElementById("lyricsModalText");
    const lyricsCloseBtn = document.getElementById("lyricsCloseBtn");
    const trackRealtimeStats = new Map();
    const LYRICS_DESYNC_SLUG = "yashlek";

    let currentAudio = null;
    let currentCard = null;
    let lyricsActiveCard = null;
    let lyricsActiveSlug = "";
    let lyricsDesyncTimer = null;

    function setDefaultTilt(card) {
      if (!card) return;
      card.style.setProperty("--tilt-x", "0deg");
      card.style.setProperty("--tilt-y", "0deg");
      card.style.setProperty("--glow-x", "50%");
      card.style.setProperty("--glow-y", "50%");
    }

    function handleCardPointerMove(event) {
      const card = event.currentTarget;
      const rect = card.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;
      const rotateX = ((rect.height / 2 - y) / rect.height) * 12;
      const rotateY = ((x - rect.width / 2) / rect.width) * 16;
      card.style.setProperty("--tilt-x", `${rotateX.toFixed(2)}deg`);
      card.style.setProperty("--tilt-y", `${rotateY.toFixed(2)}deg`);
      card.style.setProperty("--glow-x", `${((x / rect.width) * 100).toFixed(2)}%`);
      card.style.setProperty("--glow-y", `${((y / rect.height) * 100).toFixed(2)}%`);
    }

    function handleCardPointerLeave(event) {
      setDefaultTilt(event.currentTarget);
    }

    function bindInteractiveMotion() {
      trackCards.forEach(card => {
        if (card.dataset.motion === "off" || card.__motionBound) {
          return;
        }
        setDefaultTilt(card);
        card.addEventListener("pointermove", handleCardPointerMove);
        card.addEventListener("pointerleave", handleCardPointerLeave);
        card.addEventListener("pointerup", handleCardPointerLeave);
        card.__motionBound = true;
      });
    }

    function unbindInteractiveMotion() {
      trackCards.forEach(card => {
        if (!card.__motionBound) {
          setDefaultTilt(card);
          return;
        }
        card.removeEventListener("pointermove", handleCardPointerMove);
        card.removeEventListener("pointerleave", handleCardPointerLeave);
        card.removeEventListener("pointerup", handleCardPointerLeave);
        card.__motionBound = false;
        setDefaultTilt(card);
      });
    }

    if (!prefersReducedMotion.matches) {
      bindInteractiveMotion();
    } else {
      trackCards.forEach(setDefaultTilt);
    }

    const handleMotionPreferenceChange = event => {
      if (event.matches) {
        unbindInteractiveMotion();
      } else {
        bindInteractiveMotion();
      }
    };

    if (typeof prefersReducedMotion.addEventListener === "function") {
      prefersReducedMotion.addEventListener("change", handleMotionPreferenceChange);
    } else if (typeof prefersReducedMotion.addListener === "function") {
      prefersReducedMotion.addListener(handleMotionPreferenceChange);
    }

    function clearBodyCover() {
      document.body.classList.remove("has-active-cover");
      document.body.style.removeProperty("--active-cover");
    }

    function setBodyCover(card) {
      if (!card) {
        clearBodyCover();
        return;
      }
      const cover = card.querySelector(".track-cover");
      const backgroundImage = cover ? cover.style.backgroundImage : "";
      if (backgroundImage) {
        document.body.style.setProperty("--active-cover", backgroundImage);
        document.body.classList.add("has-active-cover");
      } else {
        clearBodyCover();
      }
    }

    function formatTime(seconds) {
      if (!Number.isFinite(seconds)) {
        return "0:00";
      }
      const minutes = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${minutes}:${secs < 10 ? "0" : ""}${secs}`;
    }

    function formatCount(value) {
      return numberFormatter.format(Math.max(0, Math.floor(value)));
    }

    function setupTrackStats(card) {
      if (trackRealtimeStats.has(card)) {
        return;
      }
      const likeBtn = card.querySelector(".track-like-btn");
      const likeCountEl = card.querySelector(".track-like-count");
      const playsCountEl = card.querySelector(".track-plays-count");
      const baseLikes = Number.parseInt(card.dataset.likes || "0", 10);
      const basePlays = Number.parseInt(card.dataset.plays || "0", 10);
      const stats = {
        baseLikes,
        likeBtn,
        likeCountEl,
        liked: false,
        basePlays,
        playsCountEl,
        elapsedSeconds: 0,
        lastSecondMark: 0
      };
      if (likeCountEl) {
        likeCountEl.textContent = formatCount(baseLikes);
      }
      if (playsCountEl) {
        playsCountEl.textContent = formatCount(basePlays);
      }
      if (likeBtn) {
        likeBtn.addEventListener("click", () => toggleLike(card));
      }
      trackRealtimeStats.set(card, stats);
    }

    function toggleLike(card) {
      const stats = trackRealtimeStats.get(card);
      if (!stats || !stats.likeBtn || !stats.likeCountEl) {
        return;
      }
      stats.liked = !stats.liked;
      stats.likeBtn.classList.toggle("is-liked", stats.liked);
      stats.likeBtn.setAttribute("aria-pressed", stats.liked ? "true" : "false");
      const totalLikes = stats.baseLikes + (stats.liked ? 1 : 0);
      stats.likeCountEl.textContent = formatCount(totalLikes);
    }

    function updateTrackPlays(card, audio) {
      const stats = trackRealtimeStats.get(card);
      if (!stats || !stats.playsCountEl) {
        return;
      }
      const currentSecond = Math.floor(audio.currentTime || 0);
      if (currentSecond < stats.lastSecondMark) {
        stats.lastSecondMark = currentSecond;
        return;
      }
      if (currentSecond > stats.lastSecondMark) {
        stats.elapsedSeconds += currentSecond - stats.lastSecondMark;
        stats.lastSecondMark = currentSecond;
        stats.playsCountEl.textContent = formatCount(stats.basePlays + stats.elapsedSeconds);
      }
    }

    function resetRealtimeMarker(card, currentTime = 0) {
      const stats = trackRealtimeStats.get(card);
      if (!stats) {
        return;
      }
      stats.lastSecondMark = Math.floor(Math.max(0, currentTime));
    }

    function setCardIcons(card, isPlaying) {
      const overlayIcon = card.querySelector(".play-overlay i");
      const toggleIcon = card.querySelector(".track-play-toggle i");
      const iconClass = isPlaying ? "fa-pause" : "fa-play";
      if (overlayIcon) {
        overlayIcon.className = `fas ${iconClass}`;
      }
      if (toggleIcon) {
        toggleIcon.className = `fas ${iconClass}`;
      }
    }

    function resetCard(card, audio) {
      card.classList.remove("playing");
      setCardIcons(card, false);
      const progressFilled = card.querySelector(".progress-bar-filled");
      if (progressFilled) {
        progressFilled.style.width = "0%";
      }
      const timeDisplay = card.querySelector(".time-display");
      if (timeDisplay) {
        const durationText = formatTime(audio.duration);
        timeDisplay.textContent = `0:00 / ${durationText}`;
      }
      resetRealtimeMarker(card, 0);
    }

    function updateMiniPlayerLyricsState(card) {
      if (!miniPlayerLyricsBtn) return;
      const hasLyrics = Boolean(
        card &&
        card.querySelector(".lyrics-content") &&
        card.querySelector(".lyrics-content").textContent.trim()
      );
      if (hasLyrics) {
        miniPlayerLyricsBtn.removeAttribute("disabled");
      } else {
        miniPlayerLyricsBtn.setAttribute("disabled", "disabled");
      }
    }

    function clearMiniPlayer() {
      miniPlayer.classList.remove("is-active");
      miniPlayerCover.style.backgroundImage = "";
      miniPlayerTitle.textContent = "Название трека";
      miniPlayerCurrentTime.textContent = "0:00";
      miniPlayerDuration.textContent = "0:00";
      miniPlayerProgressFilled.style.width = "0%";
      miniPlayerPlayIcon.className = "fas fa-play";
      updateMiniPlayerLyricsState(null);
      clearBodyCover();
    }

    function updateMiniPlayer(card, audio) {
      if (!card || !audio) {
        clearMiniPlayer();
        return;
      }
      miniPlayer.classList.add("is-active");
      miniPlayerTitle.textContent = card.querySelector(".track-title").textContent;
      miniPlayerCover.style.backgroundImage = card.querySelector(".track-cover").style.backgroundImage;
      miniPlayerCurrentTime.textContent = formatTime(audio.currentTime);
      miniPlayerDuration.textContent = formatTime(audio.duration);
      miniPlayerPlayIcon.className = audio.paused ? "fas fa-play" : "fas fa-pause";
      updateMiniPlayerLyricsState(card);
    }

    function stopAllExcept(cardToKeep) {
      trackCards.forEach(card => {
        const audio = card.querySelector(".track-audio");
        if (!audio || card === cardToKeep) {
          return;
        }
        audio.pause();
        audio.currentTime = 0;
        resetCard(card, audio);
        if (lyricsActiveCard === card) {
          updateLyricsDesyncState();
        }
      });
      if (!cardToKeep) {
        currentAudio = null;
        currentCard = null;
        clearMiniPlayer();
      }
    }

    function handleToggle(card, audio) {
      if (!audio) return;
      if (audio.paused) {
        const volumeValue = volumeSlider ? volumeSlider.value : "1";
        audio.volume = parseFloat(volumeValue);
        audio.play();
      } else {
        audio.pause();
      }
    }

    function openLyrics(card) {
      if (!card) {
        return;
      }
      const lyricsContent = card.querySelector(".lyrics-content");
      const rawLyrics = lyricsContent ? lyricsContent.textContent.trim() : "";
      if (!rawLyrics) {
        return;
      }
      const slug = (card.dataset.trackSlug || "").toLowerCase();
      const title = card.querySelector(".track-title");
      if (title) {
        lyricsModalTitle.textContent = title.textContent;
      }
      updateLyricsModalTheme(slug);
      renderLyricsBody(rawLyrics, slug);
      lyricsModalOverlay.classList.add("visible");
      lyricsModalOverlay.dataset.activeSlug = slug;
      lyricsActiveCard = card;
      lyricsActiveSlug = slug;
      if (slug !== LYRICS_DESYNC_SLUG) {
        stopLyricsDesync();
      }
      updateLyricsDesyncState();
    }

    trackCards.forEach(card => {
      const audio = card.querySelector(".track-audio");
      const cover = card.querySelector(".track-cover");
      const toggle = card.querySelector(".track-play-toggle");
      const progressBar = card.querySelector(".progress-bar");
      const progressFilled = card.querySelector(".progress-bar-filled");
      const timeDisplay = card.querySelector(".time-display");
      const lyricsBtn = card.querySelector(".lyrics-btn");

      setupTrackStats(card);

      if (lyricsBtn) {
        lyricsBtn.addEventListener("click", () => openLyrics(card));
      }

      if (!audio) {
        return;
      }

      if (timeDisplay) {
        timeDisplay.textContent = "0:00 / 0:00";
      }

      audio.addEventListener("loadedmetadata", () => {
        if (timeDisplay) {
          timeDisplay.textContent = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
        }
        if (audio === currentAudio) {
          miniPlayerDuration.textContent = formatTime(audio.duration);
        }
      });

      [cover, toggle].forEach(control => {
        if (control) {
          control.addEventListener("click", () => handleToggle(card, audio));
        }
      });

      audio.addEventListener("play", () => {
        stopAllExcept(card);
        currentAudio = audio;
        currentCard = card;
        card.classList.add("playing");
        setCardIcons(card, true);
        updateMiniPlayer(card, audio);
        resetRealtimeMarker(card, audio.currentTime);
        setBodyCover(card);
        if (lyricsActiveCard === card) {
          updateLyricsDesyncState();
        }
      });

      audio.addEventListener("pause", () => {
        setCardIcons(card, false);
        card.classList.remove("playing");
        resetRealtimeMarker(card, audio.currentTime);
        if (currentAudio === audio) {
          updateMiniPlayer(card, audio);
          clearBodyCover();
        }
        if (lyricsActiveCard === card) {
          updateLyricsDesyncState();
        }
      });

      audio.addEventListener("timeupdate", () => {
        updateTrackPlays(card, audio);
        const hasDuration = Number.isFinite(audio.duration) && audio.duration > 0;
        const progress = hasDuration ? (audio.currentTime / audio.duration) * 100 : 0;
        if (progressFilled) {
          progressFilled.style.width = `${progress}%`;
        }
        if (timeDisplay) {
          timeDisplay.textContent = `${formatTime(audio.currentTime)} / ${formatTime(audio.duration)}`;
        }
        if (currentAudio === audio) {
          miniPlayerProgressFilled.style.width = `${progress}%`;
          miniPlayerCurrentTime.textContent = formatTime(audio.currentTime);
          miniPlayerDuration.textContent = formatTime(audio.duration);
        }
      });

      audio.addEventListener("ended", () => {
        resetCard(card, audio);
        if (currentAudio === audio) {
          currentAudio = null;
          currentCard = null;
          clearMiniPlayer();
        }
        if (lyricsActiveCard === card) {
          updateLyricsDesyncState();
        }
      });

      audio.addEventListener("seeked", () => {
        resetRealtimeMarker(card, audio.currentTime);
        if (lyricsActiveCard === card) {
          updateLyricsDesyncState();
        }
      });

      if (progressBar) {
        progressBar.addEventListener("click", event => {
          if (!Number.isFinite(audio.duration) || audio.duration === 0) {
            return;
          }
          const rect = progressBar.getBoundingClientRect();
          const ratio = (event.clientX - rect.left) / rect.width;
          audio.currentTime = Math.max(0, Math.min(audio.duration, ratio * audio.duration));
        });
      }
    });

    miniPlayerPlayBtn.addEventListener("click", () => {
      if (!currentAudio) {
        return;
      }
      if (currentAudio.paused) {
        currentAudio.play();
      } else {
        currentAudio.pause();
      }
    });

    miniPlayerProgressBar.addEventListener("click", event => {
      if (!currentAudio || !Number.isFinite(currentAudio.duration) || currentAudio.duration === 0) {
        return;
      }
      const rect = miniPlayerProgressBar.getBoundingClientRect();
      const ratio = (event.clientX - rect.left) / rect.width;
      currentAudio.currentTime = Math.max(0, Math.min(currentAudio.duration, ratio * currentAudio.duration));
    });

    volumeSlider.addEventListener("input", event => {
      const volume = parseFloat(event.target.value);
      if (currentAudio) {
        currentAudio.volume = volume;
      }
    });

    if (miniPlayerLyricsBtn) {
      miniPlayerLyricsBtn.addEventListener("click", () => openLyrics(currentCard));
    }

    lyricsCloseBtn.addEventListener("click", closeLyricsModal);

    lyricsModalOverlay.addEventListener("click", event => {
      if (event.target === lyricsModalOverlay) {
        closeLyricsModal();
      }
    });

    document.addEventListener("keydown", event => {
      if (event.key === "Escape") {
        closeLyricsModal();
      }
    });

    (async function () {
      const STORAGE_KEY = "avzalov_profile_v1";
      const USERS_REGISTRY_KEY = "avzalov_users_registry_v1";
      const USED_CODES_KEY = "avzalov_used_admin_codes_v1";
      const USERS_DATA_ENDPOINT = "data/users.json";
      const ADMIN_CODES_ENDPOINT = "data/admin-codes.json";
      const WELCOME_BONUS = 10;
      const RUZCOIN_PRICE_RUB = 10;
      const roleLabelMap = {
        admin: "Администратор",
        listener: "Слушатель",
        moderator: "Модератор"
      };

      const profilePanelEl = document.getElementById("profilePanel");
      const profileEmptyEl = document.getElementById("profileEmpty");
      const profileNameEl = document.getElementById("profileName");
      const profileIdEl = document.getElementById("profileId");
      const profileRoleEl = document.getElementById("profileRole");
      const coinsAmountEl = document.getElementById("coinsAmount");
      const achievementsGridEl = document.getElementById("achievementsGrid");

      const loginForm = document.getElementById("loginForm");
      const adminCodeForm = document.getElementById("adminCodeForm");
      const adminCodeInput = document.getElementById("adminCodeInput");
      const adminNameInput = document.getElementById("adminNameInput");
      const adminLoginToggle = document.getElementById("adminLoginToggle");
      const earnDemoBtn = document.getElementById("earnDemoCoinsBtn");
      const profileTopupBtn = document.getElementById("profileTopupBtn");
      const logoutButtons = Array.from(document.querySelectorAll('[data-action="logout"]'));

      const headerCoinsBtn = document.getElementById("headerCoinsBtn");
      const headerCoinsPopover = document.getElementById("headerCoinsPopover");
      const coinsInfoBtn = document.getElementById("coinsInfoBtn");
      const headerProfileBtn = document.getElementById("headerProfileBtn");
      const headerProfilePopover = document.getElementById("headerProfilePopover");
      const headerProfileNameEl = document.getElementById("headerProfileName");
      const headerCoinsAmountEl = document.getElementById("headerCoinsAmount");
      const openProfileSectionBtn = document.getElementById("openProfileSectionBtn");
      const popoverProfileNameEl = document.getElementById("popoverProfileName");
      const popoverProfileIdEl = document.getElementById("popoverProfileId");
      const popoverCoinsAmountEl = document.getElementById("popoverCoinsAmount");
      const popoverProfileRoleEl = document.getElementById("popoverProfileRole");
      const ruzcoinPriceValueEl = document.getElementById("ruzcoinPriceValue");

      let currentUser = null;
      let usersRegistry = new Map();
      let adminCodes = new Map();
      let usedAdminCodes = {};
      const popoverControllers = [];
      let coinsPopoverController = null;
      let profilePopoverController = null;

      const profilePopoverLoggedOutSection = headerProfilePopover
        ? headerProfilePopover.querySelector('[data-state="logged-out"]')
        : null;
      const profilePopoverLoggedInSection = headerProfilePopover
        ? headerProfilePopover.querySelector('[data-state="logged-in"]')
        : null;

      const baseAchievements = [
        { id: "welcome", title: "Новый слушатель", desc: "Вошёл в профиль впервые.", coins: 10 },
        { id: "first_unlock", title: "Первый доступ", desc: "Открыл закрытый трек.", coins: 0 },
        { id: "collector", title: "Коллекционер", desc: "Открыл 3 закрытых трека.", coins: 0 }
      ];

      function generateUserId() {
        return `RUZ-${Math.random().toString(16).slice(2, 8).toUpperCase()}`;
      }

      function ensureUserShape(rawUser = {}) {
        const safeUser = { ...rawUser };
        safeUser.id = typeof safeUser.id === "string" && safeUser.id.trim()
          ? safeUser.id.trim()
          : generateUserId();
        safeUser.name = typeof safeUser.name === "string" && safeUser.name.trim()
          ? safeUser.name.trim()
          : "Гость";
        const coinsValue = Number.parseInt(safeUser.coins, 10);
        safeUser.coins = Number.isFinite(coinsValue) ? Math.max(0, coinsValue) : 0;
        safeUser.role = typeof safeUser.role === "string" && safeUser.role.trim()
          ? safeUser.role.trim().toLowerCase()
          : "listener";
        safeUser.password = typeof safeUser.password === "string" ? safeUser.password : "";
        if (!Array.isArray(safeUser.unlockedTracks)) {
          safeUser.unlockedTracks = [];
        }
        safeUser.unlockedTracks = Array.from(new Set(safeUser.unlockedTracks));
        if (!safeUser.achievements || typeof safeUser.achievements !== "object") {
          safeUser.achievements = {};
        }
        return safeUser;
      }

      function sanitizeUserForRegistry(user) {
        const shaped = ensureUserShape(user);
        return {
          id: shaped.id,
          name: shaped.name,
          coins: shaped.coins,
          role: shaped.role,
          password: shaped.password,
          unlockedTracks: Array.from(new Set(shaped.unlockedTracks)),
          achievements: { ...shaped.achievements }
        };
      }

      function persistUsersRegistry() {
        try {
          const payload = JSON.stringify(Array.from(usersRegistry.values()));
          localStorage.setItem(USERS_REGISTRY_KEY, payload);
        } catch (error) {
          console.warn("Не удалось сохранить список пользователей:", error);
        }
      }

      function loadUsersRegistryFromStorage() {
        const raw = localStorage.getItem(USERS_REGISTRY_KEY);
        if (!raw) {
          return [];
        }
        try {
          const parsed = JSON.parse(raw);
          return Array.isArray(parsed) ? parsed : [];
        } catch (error) {
          console.warn("Не удалось разобрать сохранённых пользователей:", error);
          return [];
        }
      }

      function bootstrapRegistryFromArray(list = []) {
        usersRegistry = new Map();
        list.forEach(entry => {
          const cleaned = sanitizeUserForRegistry(entry);
          usersRegistry.set(cleaned.id, cleaned);
        });
        persistUsersRegistry();
      }

      function loadUsedAdminCodes() {
        const raw = localStorage.getItem(USED_CODES_KEY);
        if (!raw) {
          return {};
        }
        try {
          const parsed = JSON.parse(raw);
          return parsed && typeof parsed === "object" ? parsed : {};
        } catch (error) {
          console.warn("Не удалось загрузить использованные коды:", error);
          return {};
        }
      }

      function persistUsedAdminCodes() {
        try {
          localStorage.setItem(USED_CODES_KEY, JSON.stringify(usedAdminCodes));
        } catch (error) {
          console.warn("Не удалось сохранить использованные коды:", error);
        }
      }

      function markAdminCodeUsed(code, userId) {
        if (!code) {
          return;
        }
        usedAdminCodes[code] = userId;
        persistUsedAdminCodes();
      }

      function formatRoleLabel(role) {
        const normalized = (role || "").toLowerCase();
        if (roleLabelMap[normalized]) {
          return roleLabelMap[normalized];
        }
        if (!normalized) {
          return roleLabelMap.listener;
        }
        return normalized.charAt(0).toUpperCase() + normalized.slice(1);
      }

      function updateRuzcoinPriceDisplay() {
        if (ruzcoinPriceValueEl) {
          const formattedPrice = `${RUZCOIN_PRICE_RUB.toLocaleString("ru-RU")} ₽`;
          ruzcoinPriceValueEl.textContent = formattedPrice;
        }
      }

      function updateHeaderCoins(value) {
        const numericValue = Number.isFinite(Number(value)) ? Number(value) : 0;
        const formatted = numberFormatter.format(numericValue);
        if (headerCoinsAmountEl) {
          headerCoinsAmountEl.textContent = formatted;
        }
        if (popoverCoinsAmountEl) {
          popoverCoinsAmountEl.textContent = formatted;
        }
      }

      function updateHeaderProfileNameDisplay(name) {
        if (headerProfileNameEl) {
          headerProfileNameEl.textContent = name || "Войти";
        }
      }

      function updateProfilePopoverState() {
        const isLoggedIn = Boolean(currentUser);
        if (profilePopoverLoggedOutSection) {
          profilePopoverLoggedOutSection.classList.toggle("is-visible", !isLoggedIn);
        }
        if (profilePopoverLoggedInSection) {
          profilePopoverLoggedInSection.classList.toggle("is-visible", isLoggedIn);
        }
        if (isLoggedIn) {
          if (popoverProfileNameEl) {
            popoverProfileNameEl.textContent = currentUser.name;
          }
          if (popoverProfileIdEl) {
            popoverProfileIdEl.textContent = currentUser.id;
          }
          if (popoverProfileRoleEl) {
            popoverProfileRoleEl.textContent = formatRoleLabel(currentUser.role);
          }
        } else {
          if (popoverProfileNameEl) {
            popoverProfileNameEl.textContent = "Гость";
          }
          if (popoverProfileIdEl) {
            popoverProfileIdEl.textContent = "—";
          }
          if (popoverProfileRoleEl) {
            popoverProfileRoleEl.textContent = formatRoleLabel("listener");
          }
          if (adminLoginToggle) {
            adminLoginToggle.open = false;
          }
        }
      }

      function closeAllPopovers(exceptController) {
        popoverControllers.forEach(controller => {
          if (controller !== exceptController) {
            controller.close();
          }
        });
      }

      function attachPopover(button, popover) {
        if (!button || !popover) {
          return null;
        }
        popover.dataset.open = "false";
        popover.setAttribute("aria-hidden", "true");
        const controller = {
          button,
          popover,
          isOpen() {
            return popover.dataset.open === "true";
          },
          open() {
            closeAllPopovers(controller);
            popover.dataset.open = "true";
            popover.setAttribute("aria-hidden", "false");
            button.setAttribute("aria-expanded", "true");
          },
          close() {
            popover.dataset.open = "false";
            popover.setAttribute("aria-hidden", "true");
            button.setAttribute("aria-expanded", "false");
          },
          toggle() {
            if (this.isOpen()) {
              this.close();
            } else {
              this.open();
            }
          }
        };
        button.addEventListener("click", event => {
          event.preventDefault();
          controller.toggle();
        });
        popoverControllers.push(controller);
        return controller;
      }

      document.addEventListener("click", event => {
        const target = event.target;
        const shouldIgnore = popoverControllers.some(controller => {
          return controller.button.contains(target) || controller.popover.contains(target);
        });
        if (!shouldIgnore) {
          closeAllPopovers();
        }
      });

      document.addEventListener("keydown", event => {
        if (event.key === "Escape") {
          closeAllPopovers();
        }
      });

      async function fetchJson(url) {
        try {
          const response = await fetch(url, { cache: "no-store" });
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }
          return await response.json();
        } catch (error) {
          console.warn(`Не удалось загрузить ${url}:`, error);
          return null;
        }
      }

      function findUserByCredentials(name, password) {
        if (!name || !password) {
          return null;
        }
        const normalizedName = name.trim().toLowerCase();
        for (const user of usersRegistry.values()) {
          if (user.name.trim().toLowerCase() === normalizedName && user.password === password) {
            return sanitizeUserForRegistry(user);
          }
        }
        return null;
      }

      function syncUserWithRegistry(user) {
        if (!user || !user.id) {
          return null;
        }
        const fromRegistry = usersRegistry.get(user.id);
        if (fromRegistry) {
          return ensureUserShape(fromRegistry);
        }
        return ensureUserShape(user);
      }

      function upsertUserInRegistry(user) {
        const cleaned = sanitizeUserForRegistry(user);
        usersRegistry.set(cleaned.id, cleaned);
        persistUsersRegistry();
      }

      function saveProfile() {
        if (!currentUser) {
          return;
        }
        upsertUserInRegistry(currentUser);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(currentUser));
      }

      function applyLoggedOutState() {
        if (profilePanelEl) {
          profilePanelEl.hidden = true;
        }
        if (profileEmptyEl) {
          profileEmptyEl.hidden = false;
        }
        if (profileNameEl) {
          profileNameEl.textContent = "Гость";
        }
        if (profileIdEl) {
          profileIdEl.textContent = "—";
        }
        if (profileRoleEl) {
          profileRoleEl.textContent = formatRoleLabel("listener");
        }
        if (coinsAmountEl) {
          coinsAmountEl.textContent = "0";
        }
        if (achievementsGridEl) {
          achievementsGridEl.innerHTML = "";
        }
        updateHeaderCoins(0);
        updateHeaderProfileNameDisplay("Войти");
        updateProfilePopoverState();
        closeAllPopovers();
      }

      function renderAchievements() {
        if (!achievementsGridEl) {
          return;
        }
        achievementsGridEl.innerHTML = "";
        baseAchievements.forEach(achievement => {
          const unlocked = Boolean(currentUser && currentUser.achievements && currentUser.achievements[achievement.id]);
          const card = document.createElement("div");
          card.className = `achievement-card${unlocked ? " unlocked" : ""}`;
          card.innerHTML = `
            <div class="achievement-title">${achievement.title}</div>
            <div class="achievement-desc">${achievement.desc}</div>
            ${unlocked ? '<div class="achievement-badge">получено</div>' : ""}
          `;
          achievementsGridEl.appendChild(card);
        });
      }

      function updateLockedTracksState() {
        const cards = document.querySelectorAll("[data-track-locked]");
        cards.forEach(card => {
          const trackId = card.dataset.trackLocked;
          const price = Number(card.dataset.trackPrice || 0);
          const unlockBtn = card.querySelector(".unlock-btn");
          const note = card.querySelector(".track-locked-note");
          const controls = card.querySelector(".player-controls");
          const playButton = card.querySelector(".track-play-toggle");
          const toggleIcon = playButton ? playButton.querySelector("i") : null;
          const overlayIcon = card.querySelector(".track-cover .play-overlay i");
          const audioEl = card.querySelector(".track-audio");

          const isUnlocked = Boolean(
            currentUser &&
            Array.isArray(currentUser.unlockedTracks) &&
            currentUser.unlockedTracks.includes(trackId)
          );

          if (isUnlocked) {
            card.classList.remove("track-locked");
            if (unlockBtn) {
              unlockBtn.textContent = "Открыто";
              unlockBtn.setAttribute("disabled", "disabled");
            }
            if (note) {
              const unlockedText = note.dataset.unlockedText;
              if (unlockedText) {
                note.textContent = unlockedText;
              }
              note.classList.remove("is-hidden");
            }
            const hasAudio = Boolean(audioEl);
            if (controls) {
              if (hasAudio) {
                controls.classList.remove("is-disabled");
              } else {
                controls.classList.add("is-disabled");
              }
            }
            if (playButton) {
              if (hasAudio) {
                playButton.removeAttribute("disabled");
                playButton.setAttribute("aria-label", "Воспроизвести превью");
              } else {
                playButton.setAttribute("disabled", "disabled");
                playButton.setAttribute("aria-label", "Превью появится скоро");
              }
            }
            if (overlayIcon) {
              overlayIcon.className = "fas fa-play";
            }
            if (toggleIcon) {
              toggleIcon.className = "fas fa-play";
            }
            setCardIcons(card, false);
          } else {
            card.classList.add("track-locked");
            if (unlockBtn) {
              unlockBtn.textContent = `Открыть за ${price} RUZCOIN`;
              unlockBtn.removeAttribute("disabled");
            }
            if (note) {
              const lockedText = note.dataset.lockedText;
              if (lockedText) {
                note.textContent = lockedText;
              }
              note.classList.remove("is-hidden");
            }
            if (controls && !controls.classList.contains("is-disabled")) {
              controls.classList.add("is-disabled");
            }
            if (playButton) {
              playButton.setAttribute("disabled", "disabled");
              playButton.setAttribute("aria-label", "Предпрослушивание недоступно");
            }
            if (overlayIcon) {
              overlayIcon.className = "fas fa-lock";
            }
            if (toggleIcon) {
              toggleIcon.className = "fas fa-lock";
            }
          }
        });
      }

      function showProfile() {
        if (!currentUser) {
          applyLoggedOutState();
          updateLockedTracksState();
          return;
        }
        if (profileEmptyEl) {
          profileEmptyEl.hidden = true;
        }
        if (profilePanelEl) {
          profilePanelEl.hidden = false;
        }
        if (profileNameEl) {
          profileNameEl.textContent = currentUser.name;
        }
        if (profileIdEl) {
          profileIdEl.textContent = currentUser.id;
        }
        if (profileRoleEl) {
          profileRoleEl.textContent = formatRoleLabel(currentUser.role);
        }
        if (coinsAmountEl) {
          coinsAmountEl.textContent = currentUser.coins;
        }
        updateHeaderCoins(currentUser.coins);
        updateHeaderProfileNameDisplay(currentUser.name);
        updateProfilePopoverState();
        renderAchievements();
        updateLockedTracksState();
      }

      function logout() {
        currentUser = null;
        localStorage.removeItem(STORAGE_KEY);
        applyLoggedOutState();
        updateLockedTracksState();
      }

      function loadProfile() {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (!stored) {
          currentUser = null;
          applyLoggedOutState();
          updateLockedTracksState();
          return;
        }
        try {
          const parsed = JSON.parse(stored);
          currentUser = syncUserWithRegistry(parsed);
          if (currentUser) {
            showProfile();
          } else {
            currentUser = null;
            applyLoggedOutState();
          }
        } catch (error) {
          console.warn("Не удалось загрузить профиль AVZALØV:", error);
          currentUser = null;
          localStorage.removeItem(STORAGE_KEY);
          applyLoggedOutState();
        }
      }

      function initLockedTracks() {
        const lockedButtons = document.querySelectorAll("[data-unlock-price]");
        lockedButtons.forEach(btn => {
          btn.addEventListener("click", () => {
            if (!btn.dataset.trackId) {
              return;
            }
            if (!currentUser) {
              if (profilePopoverController) {
                profilePopoverController.open();
              } else {
                alert("Сначала войди в профиль, чтобы использовать RUZCOIN.");
              }
              return;
            }
            const price = Number(btn.dataset.unlockPrice || 0);
            const trackId = btn.dataset.trackId;
            if (currentUser.unlockedTracks.includes(trackId)) {
              alert("Этот трек уже открыт.");
              return;
            }
            if (currentUser.coins < price) {
              alert("Не хватает RUZCOIN. Заработай или купи ещё.");
              if (coinsPopoverController) {
                coinsPopoverController.open();
              }
              if (headerCoinsBtn && typeof headerCoinsBtn.focus === "function") {
                try {
                  headerCoinsBtn.focus({ preventScroll: true });
                } catch (error) {
                  headerCoinsBtn.focus();
                }
              }
              return;
            }
            currentUser.coins -= price;
            currentUser.unlockedTracks.push(trackId);
            if (coinsAmountEl) {
              coinsAmountEl.textContent = currentUser.coins;
            }
            updateHeaderCoins(currentUser.coins);
            if (!currentUser.achievements.first_unlock) {
              currentUser.achievements.first_unlock = true;
            }
            if (currentUser.unlockedTracks.length >= 3) {
              currentUser.achievements.collector = true;
            }
            saveProfile();
            renderAchievements();
            updateProfilePopoverState();
            updateLockedTracksState();
            alert("Трек открыт! Спасибо за поддержку AVZALØV.");
          });
        });
      }

      coinsPopoverController = attachPopover(headerCoinsBtn, headerCoinsPopover);
      profilePopoverController = attachPopover(headerProfileBtn, headerProfilePopover);

      if (coinsInfoBtn) {
        coinsInfoBtn.addEventListener("click", () => {
          closeAllPopovers();
          const profileSection = document.getElementById("profile");
          if (profileSection) {
            profileSection.scrollIntoView({ behavior: "smooth" });
          }
        });
      }

      if (openProfileSectionBtn) {
        openProfileSectionBtn.addEventListener("click", () => {
          closeAllPopovers();
          const profileSection = document.getElementById("profile");
          if (profileSection) {
            profileSection.scrollIntoView({ behavior: "smooth" });
          }
        });
      }

      if (profileTopupBtn) {
        profileTopupBtn.addEventListener("click", () => {
          closeAllPopovers();
          if (headerCoinsBtn && typeof headerCoinsBtn.focus === "function") {
            try {
              headerCoinsBtn.focus({ preventScroll: true });
            } catch (error) {
              headerCoinsBtn.focus();
            }
          }
          if (coinsPopoverController) {
            coinsPopoverController.open();
          }
          window.scrollTo({ top: 0, behavior: "smooth" });
        });
      }

      logoutButtons.forEach(button => {
        button.addEventListener("click", () => {
          logout();
        });
      });

      if (earnDemoBtn) {
        earnDemoBtn.addEventListener("click", () => {
          if (!currentUser) {
            if (profilePopoverController) {
              profilePopoverController.open();
            } else {
              alert("Войди в профиль, чтобы получить бонусные RUZCOIN.");
            }
            return;
          }
          currentUser.coins += 5;
          if (coinsAmountEl) {
            coinsAmountEl.textContent = currentUser.coins;
          }
          updateHeaderCoins(currentUser.coins);
          saveProfile();
          updateProfilePopoverState();
        });
      }

      if (loginForm) {
        loginForm.addEventListener("submit", event => {
          event.preventDefault();
          const nameInput = document.getElementById("loginName");
          const passInput = document.getElementById("loginPassword");
          const nameValue = nameInput ? nameInput.value.trim() : "";
          const passValue = passInput ? passInput.value.trim() : "";
          if (!nameValue || !passValue) {
            alert("Нужно указать ник и пароль.");
            return;
          }
          const existingUser = findUserByCredentials(nameValue, passValue);
          if (existingUser) {
            currentUser = ensureUserShape(existingUser);
          } else {
            currentUser = ensureUserShape({
              id: generateUserId(),
              name: nameValue,
              coins: WELCOME_BONUS,
              role: "listener",
              password: passValue,
              achievements: { welcome: true },
              unlockedTracks: []
            });
          }
          saveProfile();
          if (loginForm) {
            loginForm.reset();
          }
          if (profilePopoverController) {
            profilePopoverController.close();
          }
          showProfile();
        });
      }

      if (adminCodeForm) {
        adminCodeForm.addEventListener("submit", event => {
          event.preventDefault();
          const codeValue = adminCodeInput ? adminCodeInput.value.trim().toUpperCase() : "";
          const displayName = adminNameInput ? adminNameInput.value.trim() : "";
          if (!codeValue) {
            alert("Нужно указать уникальный код администратора.");
            return;
          }
          const codeEntry = adminCodes.get(codeValue);
          if (!codeEntry) {
            alert("Код не найден. Проверь правильность ввода.");
            return;
          }
          if (usedAdminCodes[codeValue]) {
            alert("Этот код уже был активирован.");
            return;
          }
          const role = codeEntry.role ? String(codeEntry.role).trim().toLowerCase() : "admin";
          const name = displayName || codeEntry.label || "Администратор";
          currentUser = ensureUserShape({
            id: generateUserId(),
            name,
            coins: WELCOME_BONUS,
            role,
            password: codeValue,
            achievements: { welcome: true },
            unlockedTracks: []
          });
          markAdminCodeUsed(codeValue, currentUser.id);
          saveProfile();
          adminCodeForm.reset();
          if (profilePopoverController) {
            profilePopoverController.close();
          }
          showProfile();
        });
      }

      async function bootstrapData() {
        updateRuzcoinPriceDisplay();
        usedAdminCodes = loadUsedAdminCodes();
        const storedRegistry = loadUsersRegistryFromStorage();
        if (storedRegistry.length) {
          bootstrapRegistryFromArray(storedRegistry);
        } else {
          const seedUsers = await fetchJson(USERS_DATA_ENDPOINT);
          if (seedUsers && Array.isArray(seedUsers.users)) {
            bootstrapRegistryFromArray(seedUsers.users);
          }
        }
        const codesPayload = await fetchJson(ADMIN_CODES_ENDPOINT);
        if (codesPayload && Array.isArray(codesPayload.codes)) {
          adminCodes = new Map(
            codesPayload.codes
              .filter(entry => entry && entry.code)
              .map(entry => [String(entry.code).trim().toUpperCase(), { ...entry }])
          );
        }
      }

      await bootstrapData();
      loadProfile();
      initLockedTracks();
      updateLockedTracksState();
    })();

    clearMiniPlayer();
  </script>
</body>
</html>
